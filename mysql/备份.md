# 备份恢复

## 备份分类

- 物理备份

产生的副本都是二进制文件,常常不可编辑,例如数据库的二进制日志

适用于大数据量备份

- 逻辑备份

把数据库的结构定义语句,数据内容的插入语句,全部存储下来

恢复的时候在另一个mysql服务器执行这些语句,就可以创建另一个与之前一样的数据库

备份后可直接查看和编辑副本

## 备份内容

数据文件

日志文件(事务日志 二进制日志)

存储过程 存储函数 触发器

配置文件

备份脚本

## 备份工具

- mysqldump(单线程)/mysqlpump(多线程)

mysql自带的逻辑备份工具,支持全备和部分备

InnoDB:热备

MyISAM:温备

策略:全备+增备,速度相对慢

- xtrabackup

物理备份工具

支持全备+部分备 全备+增备 全备+差异备份

策略:全备配合二进制日志增量备份,速度快

## mysqldump

参数

```shell
#备份所有库，这样设置的账号密码什么的也会备份了
--all-databases

#不锁表，保证各个表具有数据一致性快照。这期间增删改查正常，但是alter table等对表结构发生更改的语句要被挂起。默认关闭。
#所以该参数明显不能保证各个表之间的数据一致性（特别是外键约束的父表和子表之间）
#一致性快照说的是如果4点开始备份，那对数据做一个快照，6点结束了，这期间只会保存4点前的，新的改变不进行同步保存，根据pos点。
--single-transaction
#将会输出CHANGE MASTER命令 用于从库的恢复，2的话会默认注释掉
--master-data=2

#导出存储过程以及自定义函数。
--routines

#导出触发器
--triggers

#开始导出之前刷新日志
--flush-logs
```



例子

备份单库的库结构、表结构、表数据

```shell
mysqldump -uroot -pxxx --single-transaction --master-data=2 --routines --flush-logs --databases text > text.sql
```

## xtarbackup

安装

1.安装依赖
`yum -y install perl perl-devel libaio libaio-devel perl-Time-HiRes perl-DBD-MySQL libev-devel`

2.下载安装
`wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.12/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.12-1.el7.x86_64.rpm`

```
yum -y install percona-xtrabackup-24-2.4.12-1.el7.x86_64.rpm
```

参数

```shell

```

