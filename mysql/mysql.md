# 入门概念

## 事务

### 概念

事务是作为单个逻辑单元执行的一系列的操作，这些操作作为一个整体向系统提交，要么执行，要么都不执行

### 模拟

说到事务，很容易想到就是那个经典的银行转账问题。假如资金从A账户转到B账户，至少需要两步，第一步，账户A的资金减少第二部，账户B的资金增加。

添加check约束，当前余额要大于1元。

``` mysql
ALTER TABLE bank
   ADD CONSTRAINT CK_Money
       CHECK(money>=1)
```

现在一共是3201元，张三200元，李四1201元，接下来执行转账操作

``` mysql
update bank set money=money-200 where name='张三';
update bank set money=money+200 where name='李四';
```

同时执行会报错，张三的金额没少，但李四却多了200

错误原因是：张三的账户减少200后，现在余额变成了0元，update语句违反约束：余额>=0元，所以会执行失败，此时报错，张三的金额不会减少。接着执行第二个update语句，第二句执行成功，所以李四增加200元，变成1401元。

转账过程就是一个事务，转账需要两条update 语句，这两条语句是一个整体，如果其中一条出现错误，那么整个转账的业务也会取消，两个账户的余额应该恢复到原来的数据，从而确保转账前和转账后的余额不变。

常用的事务语句：开始事务：begin transaction ;提交事务：commit transaction ;回滚事务：rollback transaction .一旦事务提交或者回滚，那么事务结束。使用全局变量@@ERROR，@@ERROR只能够判断当前的sql语句是否执行有错，为了判断事务中所有的sql语句是否有错，我们需要对错误累计。set @ErrorSum=@ErrorSum+@@error.

## 关系型和非关系型

### 关系型数据库

简单来说，关系模式就是二维表格模型

主要代表：SQL server、mysql、oracle

如下表，可以根据love=画画找到喜欢画画的人

| name | age  | love |
| :--: | :--: | :--: |
|  A   |  11  | 画画 |

 优点：二维表格容易理解；通用的sql语句使用方便；易于维护，数据库的[ACID属性](http://www.52wiki.cn/docs/pu/472)，大大降低了数据冗余和数据不一致的概率

缺点：高并发对硬盘IO是个挑战；难以横向扩展

### 非关系型数据库

指那些非关系型的、分布式的，且一般不保证ACID的数据存储系统，主要代表MongoDB，Redis、CouchDB。已key-value来存储值。

优点：数据放在内存，读取快；扩展方便，数据间没有关系

缺点：不支持sql，不支持事务

## 数据切分方法

### 概念

通过某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面，以达到分散单台设备负载的效果。

数据的切分（Sharding）根据其切分规则的类型，可以分为两种切分模式：垂直（纵向）切分和水平（横向）切分

### 垂直切分

### 水平切分

