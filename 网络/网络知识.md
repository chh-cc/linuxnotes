# 网络知识

## 协议层次

### OSI七层模型（理论）

| 名称   | 功能                                                         |
| ------ | ------------------------------------------------------------ |
| 应用层 | 应用层协议规定应用进程之间的通信和交互规则。不同的应用有不同的协议，如dns、http、smtp等 |
| 表示层 | 表示层的作用是把数据翻译成计算机能识别的0和1，（对称/非对称）加密，压缩 |
| 会话层 | 确定数据是否需要网络传输，需要就会交给传输层处理             |
| 传输层 | 负责给两台主机进程之间的通信提供通用的传输数据服务。对报文进行分组（发送时），组装（接收时）因为ipv4协议规定数据包的最大长度是2^16(65535)字节。提供TCP、UDP传输协议。封装端口。 |
| 网络层 | IP地址编址（源IP、目标IP），路由选择（两主机之间不止一条通信链路） |
| 链路层 | MAC地址编址、寻址                                            |
| 物理层 | 数据实际传输，电气特性定义（比如网线的8根线哪根不传输）      |

### TCP/IP参考模型（实际工作）

| 名称       | 功能                    |
| ---------- | ----------------------- |
| 应用层     | OSI应用层+表示层+会话层 |
| 传输层     | OSI传输层               |
| 网络层     | OSI网络层               |
| 网络接口层 | OSI链路层+物理层        |

### TCP/IP五层参考模型（更符合实际工作）

五层体系的协议结构是综合了 OSI 和 TCP/IP 优点的一种协议，包括应用层、传输层、网络层、数据链路层和物理层（把网络接入层拆开，因为链路层对应常见设备为交换机，物理层对应网线，这两个层不适合合并在一块）。

### 数据如何在各层之间传输



## 应用层

在浏览此输入url到显示页面的全过程：

![img](https://gitee.com/c_honghui/picture/raw/master/img/20220226162120.jpeg)

状态码：

|      | 类别           | 原因                       |
| ---- | -------------- | -------------------------- |
| 1xx  | 信息性状态码   | 接收的请求正在处理         |
| 2xx  | 成功状态       | 请求正常处理完毕           |
| 3xx  | 重定向         | 需要进行附加操作以完成请求 |
| 4xx  | 客户端错误代码 | 服务器无法处理请求         |
| 5xx  | 服务端错误代码 | 服务器处理请求出错         |

http1.0和http1.1的区别：

在HTTP/1.0中默认使用短连接。也就是说，客户端和服务器每进行一次HTTP操作，就建立一次连接，任务结束就中断连接。当客户端浏览器访问的某个HTML或其他类型的Web页中包含有其他的Web资源（如JavaScript文件、图像文件、CSS文件等），每遇到这样一个Web资源，浏览器就会重新建立一个HTTP会话。

而从HTTP/1.1起，默认使用长连接，用以保持连接特性。使用长连接的HTTP协议，会在响应头加入这行代码：

```text
Connection:keep-alive
```

在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，客户端再次访问这个服务器时，会继续使用这一条已经建立的连接。Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接需要客户端和服务端都支持长连接。



## 传输层

### 三次握手

三次握手机制：

- 客户端（closed→syn-sent）–发送带有 SYN 标志的数据包–一次握手–服务端（listen）【你在吗】
- 服务端（listen→syn-rcvd）–发送带有 SYN/ACK 标志的数据包–二次握手–客户端（syn-sent）【我在】
- 客户端（syn-sent→establish）–发送带有带有 ACK 标志的数据包–三次握手–服务端（syn-rcvd→establish）【我要跟你连接了】

为什么要三次握手：

目的是为了建立可靠的通信连接，确认双方的发送和接收是否正常。

第一次握手：Client 什么都不能确认；Server 确认了对方发送正常

第二次握手：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：自己接收正常，对方发送正常

第三次握手：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：自己发送、接收正常，对方发送接收正常

第二次握手为什么要传回SYN：

为了告诉发送端我接收到的信息就是你发送的信号。

传了SYN为什么还要传ACK：

传了SYN证明发送端到接收端的通道没有问题，但是接收端到发送端的通道还需要ACK信号验证。

### 四次挥手

四次挥手机制：

- 客户端（establish→fin-wait-1）-发送一个 FIN给服务端（establish），用来关闭客户端到服务器的数据传送【我要和你分手了】
- 服务器（establish→close-wait）-收到这个 FIN，它发回一 个 ACK给客户端（fin-wait-1）【我知道了】
- 服务器（close-wait→last-ack）-关闭与客户端的连接，发送一个FIN给客户端（fin-wait-2→time-wait）【我也要和你分手了】
- 客户端（time-wait→closed）-发回 ACK 报文确认，并将确认序号设置为收到序号加1，服务端（last-ack→closed）【知道了】

为什么要四次挥手：

任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。当另一方也没有数据再发送的时候，则发出连接释放通知，对方确认后就完全关闭了TCP连接。

### TCP和UDP

TCP和UDP的区别：

| 类型 | 是否面向连接 | 传输可靠性 | 传输形式   | 传输效率 | 所需资源 | 应用场景 | 首部字节 |
| ---- | ------------ | ---------- | ---------- | -------- | -------- | -------- | -------- |
| TCP  | 是           | **可靠**   | 字节流     | 慢       | 多       | 文件传输 | 20-60    |
| UDP  | 否           | 不可靠     | 数据报文段 | **快**   | 少       | 域名转换 | 8个字节  |

TCP如何保证可靠传输：

1. 应用数据被分割成 TCP 认为最适合发送的数据块。
2. TCP 给发送的每一个包进行编号，接收方对数据包进行排序，把有序数据传送给应用层。
3. **校验和：** TCP 将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。如果收到段的检验和有差错，TCP 将丢弃这个报文段和不确认收到此报文段。
4. TCP 的接收端会丢弃重复的数据。
5. **流量控制：** **TCP 连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区能接纳的数据。**当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP 使用的流量控制协议是可变大小的滑动窗口协议。 （TCP 利用**滑动窗口实现流量控制**）
6. **拥塞控制：** 当网络拥塞时，减少数据的发送。
7. **停止等待协议** ：**也是为了实现可靠传输的，它的基本原理就是每发完一个分组就停止发送，等待对方确认**。在收到确认后再发下一个分组。 
8. **超时重传：** 发送端超过一段时间没收到确认，就会重传上次发送的分组，因此每次发完一个分组就会设置一个超时定时器，其重传时间应该比数据在分组传输的平均往返时间要长一些。

## IP/子网掩码

子网掩码计算公式：

- 网络地址（网段的起始地址）：IP地址与子网掩码的二进制按位进行逻辑与运算
- 广播地址（网段的终止地址）：有效子网掩码中，有几个0，就把IP地址的后几位换成1
- 子网个数：有效子网掩码中，有几个1，子网数就是2的几次方
- 主机个数：有效子网掩码中，有几个0，就是2的几次方减2