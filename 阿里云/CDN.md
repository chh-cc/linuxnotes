# CDN

开启页面优化功能，系统将自动删除html中的注释以及重复的空白符，这样可以有效地去除页面的冗余内容，减小文件体积，提高加速分发效率。     

开启智能压缩功能后，您可以对大多数静态文件进行压缩。通过智能gzip压缩方式，有效减少传输内容大小，加速分发效果。      

本文档为您介绍了过滤参数功能及操作步骤。过滤参数是指在请求URL中，如果携带?和参数，例如：http://alibaba.com/content?a=10，CDN节点在收到请求URL后判断是否将该带参数的URL返回源站。由于大部分Http请求中包含参数，但往往参数内容优先级不高，可以忽略参数浏览文件，开启后可以有效提高文件缓存命中率，提升分发效率。  和安全性没关系

同时解决下载速度和带宽成本的问题,选择对象存储OSS和内容分发网络CDN,CDN能够加快速度，CDN和OSS之间通过内网通信，不收费，节省带宽费用

## CDN原理

什么是 CDN  

CDN 的全称是 Content Delivery Network，即**内容分发网络**。CDN 是构建在现有网络基础之上的智能虚拟网络，**依靠部署在各地的边缘服务器**，通过中心平台的负载均衡、内容分发、调度等功能模块，**使用户就近获取所需内容**，降低网络拥塞，提高用户访问响应速度和命中率。CDN 的关键技术主要包括了节点调度、节点负载均衡和内容存储、分发、管理技术。  

阿里云CDN

中国内地（大陆）拥有 2300+ 节点，覆盖 31个省级区域，大量节点位于省会等一线城市。海外、中国香港、中国澳门和中国台湾拥有 500+ 节点，覆盖 70 多个国家和地区。同时，阿里云所有节点均接入**万兆网卡**，单节点存储容量达 **40TB~1.5PB**，带宽负载达到 **40Gbps~200Gbps**，具备130Tbps 带宽储备能力。点击文档三分钟了解阿里云 CDN。  

![image-20210303133622691](https://gitee.com/c_honghui/picture/raw/master/img/20210303133622.png)

CDN工作原理

假设加速域名为 www.a.com， 接入 CDN 网络，开始使用加速服务后，当终端用户（北京）发起 HTTP 请求：

![image-20210303133841432](https://gitee.com/c_honghui/picture/raw/master/img/20210303133841.png)  

1.	 当终端用户（北京）向 www.a.com 下的某资源发起请求时，首先向 LDNS（本地 DNS）发起域名解析请求。
2.	 LDNS 检查缓存中是否有 www.a.com 的 IP 地址记录。如果有，则直接返回给终端用户；如果没有，则向授权 DNS 查询。
3.	 当授权 DNS 解析 www.a.com 时，返回域名 CNAME www.a.tbcdn.com对应 IP 地址。
4.	 域名解析请求发送至阿里云 DNS 调度系统，并为请求分配最佳节点 IP 地址。
5.	 LDNS 获取 DNS 返回的解析 IP 地址。
6.	 用户获取解析 IP 地址。
7.	 用户向获取的 IP 地址发起对该资源的访问请求。
● 如果该 IP 地址对应的节点已缓存该资源，则会将数据直接返回给用户，例如，
图中步骤 7 和 8，请求结束。
● 如果该 IP 地址对应的节点未缓存该资源，则节点向源站发起对该资源的请求。获取资源后，结合用户自定义配置的缓存策略，将资源缓存至节点，例如，图中的北京节点，并返回给用户，请求结束。配置缓存策略的操作方法，请参见缓存配置。
8.	  特别注意
     CDN 调度系统分配节点的时候，是**根据客户端的 LocalDNS 来分配节点**的，而不是根据客户端 IP 来分配节点的。因此，如果客户端 LocalDNS 设置不正确的话会导致无法分配调度到最优的节点。  

加速的资源

CDN 的缓存加速不适用于加速动态内容（asp、jsp、php、perl、cgi） ，只适用静态内容（html、css、js  ）   

如果用户的网站或 App 应用有较多动态内容，例如需要对各种 API 接口进行加速，则需要使用阿里云全站加速产品。全站加速能同时加速动态和静态内容，加速方式如下：
● 静态内容使用 CDN 加速。
● 动态内容通过阿里云的路由优化、传输优化等动态加速技术以最快的速度访问您的服务器源站获取数据。从而达到全站加速的效果。  

缓存策略

CDN 的默认缓存时间比较短，最大不超过 3600 秒，因此很容易缓存过期。  

用户可以登录阿里云 CDN 控制台配置缓存过期时间，针对静态资源配置指定目录和文件后缀名的缓存过期时间和优先级，资源过期后，自动从 CDN 节点删除。  

https://help.aliyun.com/document_detail/27136.html?spm=a2c6h.12873639.0.0.750f4da3LfAeba