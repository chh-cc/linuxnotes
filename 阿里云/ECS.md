# ECS

配置一个四层监听（TCP协议或UDP协议），并且ECS使用的是Linux系统，确保ECS实例上/etc/sysctl.conf目录下net.ipv4.conf文件中的以下三个参数的值为零：

```sh
net.ipv4.conf.default.rp_filter = 0
net.ipv4.conf.all.rp_filter = 0
net.ipv4.conf.eth0.rp_filter = 0
```

阿里云ECS默认采用dhcp分配网络，重启ecs时，dhclient会更新resolv.conf文件，这样就修改掉了ecs上配置的dns服务器。

禁止dhclient更新resolv.conf文件：
修改网卡配置文件，在该文件中添加如下语句即可：

```shell
vim /etc/sysconfig/network-scripts/ifcfg-eth0
PEERDNS=no
```

升级一台ECS服务器的CPU和内存需要停机，升级一台ECS的带宽不需要停机

selinux可能会禁止某些端口的使用，造成无法监视

## 地域和可用区

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210408232205.png" alt="img" style="zoom:67%;" />

同一可用区内的 ECS 实例网络**延时更小**

关于经营许可证备案

选择地域时您需要考虑某些地区的特殊要求。如您在中国内地地域购买了ECS实例，并**用于Web服务器，您需要完成经营许可证备案**。

如您有办理经营许可证备案的需求，请您重点关注：

- 北京地区企业，请选择购买的地域为**华北 2**。
- 广东地区企业，请选择购买的地域为**华南 1**。

## 实例

在一些业务场景下，可以通过购买按量付费的云服务器ECS实例来满足特定时间段内需要更多计算资源的需求,可以多次设置ECS实例的自动释放时间

升级包年包月实例规格无需预先停止实例，大约15分钟左右，**重启后**新实例规格才能**生效**。

升级实例带宽无需预先停止实例，大约5分钟左右。

### 配置选型

#### 实例规格

实例规格族名称格式为**ecs.<规格族>**，实例规格名称为**ecs.<规格族>.<nx>large**。

- **<规格族>**：由小写字母加数字组成。

  - c：一般表示计算型（computational）
  - g：一般表示通用型（general）
  - r：一般表示内存型（ram）
  - ne：一般表示网络增强型（network enhanced）

- 规格对应业务场景

  ![img](https://gitee.com/c_honghui/picture/raw/master/img/20210719225327.png)

- 自建服务选型

  | 应用类型 | 常用应用          | 选型原则                                                     | 推荐实例规格族                                    |
  | :------- | :---------------- | :----------------------------------------------------------- | :------------------------------------------------ |
  | 负载均衡 | Nginx             | 应用特点：需要支持**高频率的新建连接**操作。**CPU计算能力**：要求较高。内存：要求不高。 | c6e、hfc7、g5ne系列                               |
  | RPC产品  | SOFADubbo         | 应用特点：网络链接密集型；进程运行时需要消耗较高的内存。     | g6e、g6系列                                       |
  | 缓存     | RedisMemcacheSolo | CPU计算能力：要求不高。**内存**：要求较高。                  | 实例规格族：r6e、re6系列块存储：SSD云盘或ESSD云盘 |
  | 配置中心 | ZooKeeper         | 在应用启动协商时会有大量I/O读写操作。CPU计算能力：要求不高。内存：要求不高。 | 实例规格族：c6e、c6系列块存储：SSD云盘或ESSD云盘  |
  | 消息队列 | KafkaRabbitMQ     | 从消息完整性方面考虑，存储优先选用云盘。CPU计算能力：要求不高。内存和vCPU配比通常为1:1。存储：要求不高。 | 实例规格族：c6e、c6系列块存储：SSD云盘或ESSD云盘  |
  | 容器编排 | Kubernetes        | 通过弹性裸金属服务器和容器组合，可以最大限度挖掘计算潜能。   | ebmc6e、ebmg6e、ebmc6、ebmg6系列                  |
  | 大表存储 | HBase             | 一般可以选择d系列。如果业务存在超高IOPS（Input/Output Operations Per Second）需求，可以选择i系列。 | d2c、d2s系列i3系列                                |
  | 数据库   | MySQLNoSQL        | 对于存储有弹性扩展的需求，可以选择ECS和ESSD。对于I/O敏感型业务的需求，优先选择i系列。 | 实例规格：c6e、g6e、r6e系列块存储：ESSD云盘i3系列 |
  | 文本搜索 | Elasticsearch     | 选用内存与vCPU配比较大的ECS规格。日常需要将数据库数据导出成ES文件，对I/O读写有要求。 | 实例规格：g6e、g6系列块存储：ESSD云盘d2c、d2s系列 |

#### 业务指标

| 指标       | 计算周期 | 含义                                                        |
| ---------- | -------- | ----------------------------------------------------------- |
| PV         | 天       | web业务一天内的页面访问次数，每打开或刷新一次页面就算一个PV |
| UV         | 天       | web业务一天内访问站点的用户数                               |
| IP         | 天       | web业务一天内有多少个独立的IP浏览了页面                     |
| 用户数     | -        | 业务系统的注册用户数                                        |
| 活跃用户数 | 天       | 一天使用业务系统的用户数                                    |
| 在线用户数 | 天       | 活跃用户中，用户同时在一定时间段在线的数量                  |
| 并发用户数 | -        | 在线用户中，某一时刻同时向服务器发送请求的用户数            |

| PV（万） | 服务器配置   | RDS配置  |
| -------- | ------------ | -------- |
| 1        | 1核/1G/1台   | 无       |
| 10       | 2核/4G/1台   | 1核/1G   |
| 50       | 4核/8G/1台   | 2核/4G   |
| 100      | 8核/16G/1台  | 8核/16G  |
| 500      | 8核/16G/10台 | 8核/16G  |
| 1000     | 8核/16G/20台 | 16核/64G |

CPU与内存资源配比：

1：1

适用于个人网站、官网等小型网站，一般在低配机器中如1c1g、2c2g

1：2

黄金比例，最优计算资源性价比，适用绝大部分业务，游戏类应用、电商类高并发、web应用，4核8G偏向中小型web/应用类部署，8核16G偏向大中型web/应用类部署

nginx只做转发2c4g/4c8g足够，nginx+php用4c8g/8c16g经典配置

1：4

偏向内存，适合部署数据库类应用，数据库类设计数据持久化需要ssd云盘提供高存储IOPS且低读写延时

1：8

高内存占比，适用Redis、memcached部署

redis是单进程单线程，对多核利用不好，适合偏向1：4/1：8的2核8G/2核16G

根据业务类型配置：

存储型业务：主要消耗存储空间

计算型业务：如游戏，主要消耗CPU

流量型业务：如优酷，主要消耗网络带宽

### 创建实例

- 基础配置

  - 选择镜像。您可以选择公共镜像、自定义镜像、共享镜像或从镜像市场选择镜像。

  - 选择存储。

    **系统盘**：必选项，用于安装操作系统。

    **数据盘**：可选项。可以创建空云盘，也可以使用快照创建云盘。最多可以添加16块云盘作数据盘。

    **共享盘NAS**：可选项。您可以选择已经创建的文件系统进行挂载，最多可以挂载5个文件系统。

- 系统配置

  - 选择并设置登录凭证

  - 设置实例名称以及显示在操作系统内部的计算机名

    <img src="https://gitee.com/c_honghui/picture/raw/master/img/20210411012802.png" alt="image-20210411012755335" style="zoom:67%;" />

    生成的实例名分别为k8s-node-0006、k8s-node-0007、k8s-node-0008，生成的主机名分别为k8s-node-0006-ecshost、k8s-node-0007-ecshost、k8s-node-0008-ecshost

  - 设置高级选项

- 分组设置
  - 添加标签
  - 选择资源组
  - 选择部署集

#### 使用自定义镜像创建实例

可以使用自定义镜像方便地创建具有**相同操作系统、应用程序和数据**的ECS实例

前提条件：

在需要创建实例的账号和地域中持有自定义镜像。

操作：

单击**实例与镜像** > **镜像**

找到待使用的镜像，在**操作**列中，单击**创建实例**

#### 购买相同配置的实例

找到待操作实例，在**操作**列中，单击**更多** > **购买相同配置**

#### 使用实例启动模板创建实例

实例启动模板中包含了用于创建实例的配置信息，可以存储除了密码以外的任意配置信息，包括密钥对、RAM角色、实例类型和网络设置等。

实例启动模板不支持修改，但可以创建多个版本，每个版本可以配置不同的参数，通过版本管理体现实例配置的演进过程。您可以使用模板任意一个版本创建实例。

可以直接使用现有实例启动模板配置实例，省去重复选择配置项的时间。

1. 在左侧导航栏，单击**部署与弹性** > **实例启动模板**
2. 找到模板或版本，在**操作**列中，单击**创建实例**
3. 在**自定义购买**页面，选择模板和版本，待配置信息加载完成，检查所有配置信息。
4. 创建实例

### 释放ecs

释放顺序：ecs、镜像、快照、eip

### 属性

如果修改了主机名（HostName），必须在控制台或者通过API RebootInstance重启ECS实例才生效。

在实例内部修改密码后立即生效，无需重启实例

### 升降配置

#### 修改实例规格

一个实例规格已预定义vCPU和内存。修改实例规格时，您需要选择目标实例规格，不能单独修改vCPU或内存

升级按量付费实例和降配包年包月实例时，需要预先停止实例。升级包年包月实例时，需要重启实例后新配置才能生效

#### 修改公网带宽

不管是固定公网ip还是弹性公网ip，修改公网带宽计费方式、固定带宽、流量峰值都是立即生效

将公网带宽设置为0 Mbit/s

- 对专有网络实例，固定公网IP地址立即释放。
- 对经典网络实例，不再提供公网访问，但是保留固定公网IP地址。

## 安全组

通过配置安全组规则，您可以控制安全组内ECS实例的入流量和出流量。

安全组分为普通安全组和企业安全组。企业安全组面向企业级场景，可以容纳更多的实例、弹性网卡和私网IP，而且访问策略更加严格。在安全组通用特性基础上，**企业安全组**还具有以下特性：

- 仅支持专有网络。
- **默认拒绝所有出方向的访问请求**。
- 同一安全组内的实例之间默认内网隔离。



实现在阿里云的同一个专有网络VPC下的三个交换机下的云服务器ECS实例之间内网互相不能访问，但并不影响该专有网络VPC的内网其他流量？

```text
创建三个安全组,分别包含三个交换机下的所有ECS实例,先为每个安全组配置允许所有网段访问的规则,再配置禁止另外两个交换机所在的网段访问的规则,优先级要高于前者
```



建议：

- 单个安全组内尽量保持规则简洁。单台实例可以加入多个安全组，单个安全组可以添加多条安全组规则
- **不同类型应用的实例加入不同的安全组**，分别维护安全组规则。例如，需要接受公网访问的实例加入同一个安全组，默认拒绝所有访问，然后设置仅暴露对外提供服务的端口（例如80、443等）。
- 避免直接修改线上环境使用的安全组。可以**先克隆一个安全组**并在测试环境调试
- 合理定义安全组名称、标签等

### 特点

安全组具有以下功能特点：

- 一台ECS实例至少属于一个安全组，**可以同时加入多个安全组**。
- 一个安全组可以管理**同一个地域**内的多台ECS实例。
- 在没有设置允许访问的安全组规则的情况下，不同安全组内的ECS实例之间默认内网不通。
- 安全组支持有状态应用。一个有状态的会话连接中，会话的最长保持时间是910秒。安全组会默认放行同一会话中的通信。例如，在会话期内，如果连接的数据包在入方向是允许的，则在出方向也是允许的。
- 优先级从1-100，应该是数值越小，优先级越高

### 安全组规则

专有网络VPC支持入方向和出方向。经典网络支持公网出、入方向，内网出、入方向。

优先级的取值范围为1~100，数值越小，代表优先级越高。同类型规则间依赖优先级决定最终执行的规则。当ECS实例加入了多个安全组时，多个安全组会从高到低依次匹配规则。最终生效的安全组规则如下：如果两条安全组规则只有授权策略不同：拒绝策略的规则生效，允许策略的规则不生效。如果两条安全组规则只有优先级不同：优先级高的规则生效。

### 案例

案例1：阻止公网通过ssh和rdp远程访问服务器，必须通过堡垒机

创建安全组，添加公网入方向规则：

![image-20210919010658130](https://gitee.com/c_honghui/picture/raw/master/img/20210919010705.png)

私网入方向规则：

![image-20210919010741021](https://gitee.com/c_honghui/picture/raw/master/img/20210919010741.png)

案例2：同地域同账号的实例实现内网互通

- 如果在同一个安全组内，默认内网互通，不需要设置。
- 如果在不同的安全组内，默认内网不通。此时，在实例所在安全组中分别添加一条安全组规则，授权另一个安全组内的实例访问本安全组内的实例，实现内网互通。

| 网络类型 | 规则方向 | 授权策略 | 协议类型           | 端口范围     | 优先级 | 授权对象                           |
| :------- | :------- | :------- | :----------------- | :----------- | :----- | :--------------------------------- |
| 专有网络 | 入方向   | 允许     | 设置适用的协议类型 | 设置端口范围 | 1      | 输入允许访问的实例所在的安全组ID。 |

案例3：同地域不同账号的实例实现内网互通

此案例仅适用于经典网络类型的ECS实例。

UserA（账号ID：160998252992****）在华东1有一台经典网络类型的ECS实例InstanceA（内网IP：A.A.A.A），InstanceA所属的安全组为GroupA（安全组ID：sg-bp174yoe2ib1sqj5****）。

UserB（账号ID：135652617028****）在华东1有一台经典网络类型的ECS实例InstanceB（内网IP：B.B.B.B），InstanceB所属的安全组为GroupB（安全组ID：sg-bp148p6ncq1rjuvr****）。

您需要在GroupA和GroupB中分别添加安全组规则，授权InstanceA和InstanceB内网互通。

- 在GroupA中添加安全组规则，授权InstanceB内网访问InstanceA，如下表所示。

  | 网络类型 | 规则方向 | 授权策略 | 协议类型           | 端口范围     | 授权对象                                                     | 优先级 |
  | :------- | :------- | :------- | :----------------- | :----------- | :----------------------------------------------------------- | :----- |
  | 经典网络 | 入方向   | 允许     | 选择适用的协议类型 | 设置端口范围 | 格式：UserB的账号ID/GroupB的ID示例：135652617028****/sg-bp148p6ncq1rjuvr**** | 1      |

- 在GroupB中添加安全组规则，授权InstanceA内网访问InstanceB，如下表所示。

  | 网络类型 | 规则方向 | 授权策略 | 协议类型           | 端口范围     | 授权对象                                                     | 优先级 |
  | :------- | :------- | :------- | :----------------- | :----------- | :----------------------------------------------------------- | :----- |
  | 经典网络 | 入方向   | 允许     | 选择适用的协议类型 | 设置端口范围 | 格式：UserA的账号ID/GroupA的ID示例：160998252992****/sg-bp174yoe2ib1sqj5**** | 1      |

案例5：只允许实例访问外部特定ip

- 禁止实例以任何协议访问所有公网IP地址，优先级应低于允许访问的规则（如本例中设置优先级为2）。安全组规则如下表所示。

  | 网络类型 | 规则方向 | 授权策略 | 协议类型 | 端口范围 | 授权对象  | 优先级 |
  | :------- | :------- | :------- | :------- | :------- | :-------- | :----- |
  | VPC      | 出方向   | 拒绝     | 全部     | -1/-1    | 0.0.0.0/0 | 2      |

- 允许实例访问特定公网IP地址，优先级应高于拒绝访问的安全组规则的优先级（如本例中设置为1）。

  | 网络类型 | 规则方向 | 授权策略 | 协议类型           | 端口范围     | 授权对象                                             | 优先级 |
  | :------- | :------- | :------- | :----------------- | :----------- | :--------------------------------------------------- | :----- |
  | VPC      | 出方向   | 允许     | 选择适用的协议类型 | 设置端口范围 | 允许实例访问的特定CIDR，例如1.2.3.4/32或10.0.0.0/8。 | 1      |

## 快照

快照是某一时间点云盘数据状态的**备份文件**。

云盘第一份快照是实际使用量的全量快照，不备份空数据块，后续创建的快照均是增量快照，只存储变化的数据块。

快照适用范围：数据盘、系统盘

**创建自定义镜像的快照云盘属性必须是系统盘**

![img](https://gitee.com/c_honghui/picture/raw/master/img/20210412115128.png)

回滚快照操作时必需在云服务器ECS实例的**状态为“停止”**时才能进行

使用快照回滚，并不是自己创建快照自己用，**可以用别的ECS实例的快照回滚的**

### 复制快照

创建了普通快照后，您可以将普通快照**从一个地域复制到另一个地域**，复制后的快照会被分配一个与源快照不同的ID。

通过复制快照，您可以在新的地域快速启用业务，或者**将业务系统迁移到新的地域**，降低运维成本以及实现更好的可用性。

### 使用快照回滚云盘

**发生系统故障或错误操作时**，您可以使用快照回滚云盘，实现应用版本回退。

操作：

1. 在左侧导航栏，单击**实例与镜像** > **实例**。
2. 在顶部菜单栏左上角处，选择地域。
3. 找到需要回滚云盘的实例，在**操作**列中，单击**管理**
4. 在**实例详情**页，单击**快照**页签。
5. 选择需要的快照，在**操作**列中，单击**回滚磁盘**。

### 自动快照策略

创建自动快照策略：

![image-20210919013604364](https://gitee.com/c_honghui/picture/raw/master/img/20210919013604.png)

**创建快照会暂时降低块存储I/O性能**，一般性能差异在10%以内，出现短暂瞬间变慢。建议您选择避开业务高峰的时间点。

- 执行或取消自动快照

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210919014057.png" alt="image-20210919014057710" style="zoom:67%;" />

- 创建实例时启动自动快照策略

![image-20210412143107016](https://gitee.com/c_honghui/picture/raw/master/img/20210412143107.png)

- 创建云盘时启动自动快照策略

![image-20210412143526124](https://gitee.com/c_honghui/picture/raw/master/img/20210412143526.png)

## 镜像

镜像是一种地域性资源，您**不能跨地域使用镜像**创建实例。例如，在华北2（北京）地域创建实例时，您只能使用位于华北2（北京）地域的镜像。

![img](https://gitee.com/c_honghui/picture/raw/master/img/20210409000535.png)

### 镜像类型

| 镜像分类   | 含义                                                         |
| ---------- | ------------------------------------------------------------ |
| 公共镜像   | 阿里云官网创建好的                                           |
| 自定义镜像 | 通过快照创建镜像、通过实例创建镜像，**会产生快照费用**，适用范围：**仅系统盘** |
| 共享镜像   | 别人共享给你的                                               |
| 镜像市场   | 别人创建的镜像共享出来一起使用                               |

### 用快照创建自定义镜像

通过创建自定义镜像，您可以将一台ECS实例的操作系统、数据制作成环境副本，再**通过自定义镜像创建多台ECS实例**，**快速复制系统环境**。

前提：您已经创建了一份系统盘快照。

找到目标实例，单机管理：

![img](https://gitee.com/c_honghui/picture/raw/master/img/20210412001245.png)

单机快照，找到云盘属性为系统盘的目标快照，单击创建自定义镜像：

![img](https://gitee.com/c_honghui/picture/raw/master/img/20210412001313.png)

**注意：**

- 必须包含一份系统盘快照创建自定义镜像。仅包含数据盘快照无法创建自定义镜像。
- 加密快照和非加密快照均可用于创建自定义镜像。
- 创建快照的**源ECS实例到期或释放后**，使用该快照创建的自定义镜像不受影响，使用该镜像创建的ECS实例也不受影响。
- 使用自定义镜像创建VPC网络的ECS实例后，可能出现网络无法连通的异常情况。

### 用实例创建自定义镜像

创建实例后，您可以根据业务需要自定义实例（如安装软件、部署应用环境等），并为更新后的实例创建自定义镜像。使用该镜像创建的新实例，会包含您已配置的自定义项，省去您重复自定义实例的时间。

前提：

- 检查实例的网络配置。
- 检查系统盘使用剩余空间，确保系统盘没有被写满。

**注意：**

- **无需停止实例**即可创建镜像。
- 镜像创建过程中，不能改变实例的状态。例如，不要停止、启动或者重启实例，避免创建失败。
- 实例及其创建的镜像属于同一个地域。
- **不要在/etc/fstab文件中加载数据盘信息**，否则使用该镜像创建的实例无法启动。

操作：

1. 找到目标实例。在**操作**列中，单击**更多** > **云盘和镜像** > **创建自定义镜像**。

## 块存储

云端存储产品可以分为两大类：

- 数据库类云产品，用于**结构化数据**及**半结构化数据**的持久化存储
- 块存储（云盘）、共享块存储（共享云盘）、共享文件存储、OSS对象存储用于**非结构化数据**的持久化存储

块存储可以像使用物理硬盘一样格式化并建立文件系统来使用块存储，云盘采用**分布式三副本机制**，为ECS实例提供99.9999999%的数据可靠性保证

- 系统盘

  云盘不建议分区，建议直接**格式化一块云盘**，后期只需使用**resize2fs**扩大文件系统然后重新挂载即可

  不建议用LVM，导致无法使用快照

  建议ECS创建完后再给对应的ECS绑定挂载云盘，这样云盘不会随着ECS释放而释放

  系统盘主要存储操作系统所需要的运行的文件及日志

- 数据盘

  数据盘可以存储java、php等代码文件

  一个ECS实例最多可以挂载16块数据盘

  ECS 实例的系统盘使用的 SSD 云盘,需要新增数据盘时不能使用本地SSD 盘

#### 挂载数据盘

可以将单独创建的按量付费云盘挂载到ECS实例上，作为数据盘使用

前提：

- 被挂载的**实例和云盘在同一个可用区**。
- 被挂载的实例的状态为**运行中**（Running）或者**已停止**（Stopped），不能为**已锁定**（Locked）。
- 云盘的状态为**待挂载**（Available）。
- 您的账号不欠费。

#### 格式化数据盘

- 小于2T的盘

查看数据盘信息：

```shell
fdisk -l
```

创建一个分区：

```shell
fdisk -u /dev/vdb
p查看分区情况
n创建一个分区
p选择分区类型为主分区
1输入分区编号，按回车键。
回车
回车
p
w
```

创建文件系统：

```shell
mkfs -t ext4 /dev/vdb1
或
mkfs -t xfs /dev/vdb1
```

配置/etc/fstab并挂载

由于释放云盘等操作可能会导致其他云盘的设备名变动，建议您在/etc/fstab中使用全局唯一标识符UUID来引用新分区。

```shell
cp /etc/fstab /etc/fstab.bak
echo `blkid /dev/vdb1 | awk '{print $2}' | sed 's/\"//g'` /data ext4 defaults 0 0 >> /etc/fstab
mount /dev/vdb1 /data
```

- 大于2T的盘

```shell
yum install -y parted
yum install -y e2fsprogs
fdisk -l
#分区
parted /dev/vdb
mklabel gpt
mkpart primary 1 100%
#检查分区是否对齐
align-check optimal 1
print
quit
#使系统重读分区表
partprobe
#创建文件系统
mkfs -t ext4 /dev/vdb1
mount /dev/vdb1 /test
cp /etc/fstab /etc/fstab.bak
echo `blkid /dev/vdb1 | awk '{print $2}' | sed 's/\"//g'` /test ext4 defaults 0 0 >> /etc/fstab
```

ext4文件系统默认开启lazy init功能。该功能开启时，实例会发起一个线程持续地初始化ext4文件系统的metadata，从而延迟metadata初始化。所以在格式化数据盘后的近期时间内，云盘的IOPS性能会受到影响，IOPS性能测试的数据会明显偏低。

```shell
mke2fs -O 64bit,has_journal,extents,huge_file,flex_bg,uninit_bg,dir_nlink,extra_isize -E lazy_itable_init=0,lazy_journal_init=0   /dev/vdb1
```

#### 裸设备创建文件系统

```shell
mkfs.ext4 /dev/vdb
或
mkfs.xfs /dev/vdb
```

#### 在线扩容云盘

扩容生效后**不支持缩容**

扩容系统盘后，用户创建的快照会保留

扩容ECS实例的系统盘时需要停止您的实例，因此会短暂中断您的业务

1. 为扩容云盘创建快照
2. 在平台扩容云盘容量
3. 查看云盘分区情况

```shell
fdisk -lu
```

4. 扩容分区

```shell
#分区为GPT格式，必须执行此步骤；如果您的分区为MBR格式，请跳过此步骤
yum install gdisk -y
#CentOS 7及以上版本运行以下命令。
yum install -y cloud-utils-growpart
#Debian 9及以上版本、Ubuntu14及以上版本运行以下命令。
apt-get update
apt-get install -y cloud-guest-utils
#扩容分区
growpart /dev/vda 1
```

5. 扩容文件系统

```shell
#扩容ext*
resize2fs /dev/vda1
#扩容xfs
xfs_growfs /media/vdc
```

支持在线扩容的Linux公共镜像（或基于公共镜像制作的自定义镜像）包括：

- Alibaba Cloud Linux：Alibaba Cloud Linux 2.1903 LTS 64位
- CentOS：
  - CentOS 6：CentOS 6.8及以上版本
  - CentOS 7：CentOS 7.2及以上版本
  - CentOS 8及以上版本
- Red Hat Enterprise Linux：
  - RHEL 6：RHEL 6.9及以上版本
  - RHEL 7：RHEL 7.4及以上版本
  - RHEL 8及以上版本
- Ubuntu：Ubuntu 16及以上版本
- Debian：Debian 8及以上版本
- SUSE：SUSE 12 SP2及以上版本
- OpenSUSE：OpenSUSE 42.3及以上版本

## 网络

在已经创建好的阿里云的云服务器ECS实例中进行了更改网卡mac地址的操作，可能会导致网络不通

5M带宽是指带宽总出口是5M，下行5M，**上行不限**（这里的**下行代表出网**带宽即从服务器流出的带宽;**上行代表入网**带宽即流入服务器的带宽），入口流量峰值是不受限制的，所以DDOS攻击不会产生额外的流量费用，因为**入口流量免费**。

若使用5Mbps峰值带宽，每天业务产生的流量超过5.25GB，这时使用固定带宽才划算，否则优先使用按量付费。

不建议开通ECS直接勾选绑定公网IP，建议单独开通EIP再跟ECS绑定

### 经典网络

同一个地域内，不同账号下，经典网络下可以通过安全组规则设置两台云服务器之间内网互通

### VPC

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210223224811.png" alt="image-20210223224811443" style="zoom: 80%;" />

通过与VPN连接方式结合，可以实现专有网络VPC与传统数据中心组成一个按需定制的网络环境。

VPC和VPC之间默认二层隔离，需要互通只能走高速通道（专线）

VPC网络，不管有没有绑定弹性IP，VPC网络的ECS仅有一个eth0网卡（绑定弹性IP的时候，公网数据是通过阿里云内部NAT的方式流转到ECS的eth0网卡上的）

一般只会在开启公网的ECS上开启iptables来做安全规则设置。在绑定弹性EIP的ECS中，公网流量和内网流量都是经过eth0网卡的，做iptables规则的时候比较麻烦。

#### 创建

创建VPC

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210223224533.png" alt="image-20210223224533743" style="zoom:67%;" />

创建交换机

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210223224628.png" alt="image-20210223224628452" style="zoom:67%;" />

### 修改私有IP

前提：

- 实例的弹性网卡未设置辅助私网IP地址。
- 实例处于已停止状态。

### 经典网络和VPC互通

通过建立ClassicLink连接，使经典网络类型的ECS实例可以和专有网络VPC中的云资源通过内网互通

步骤：

1. 在专有网络的基本信息页面开启ClassicLink
2. 在经典网络ECS实例的安全组，设置ClassicLink安全组规则
   - 找到目标经典网络类型ECS实例，在详情页面点**设置专有网络连接状态**，选择**目标专有网络**，点确定
   - 单击**前往实例安全组列表添加classicLink安全组规则**
