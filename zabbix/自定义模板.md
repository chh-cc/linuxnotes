# 自定义模板

监控项、触发器、图形、web、自动发现，这些数据可以做成模板

创建模板，模板得属于某个主机组(Templates)

模板具有继承功能（在一个模板中使用另一个模板）

## 添加监控项

- key可以带参数，该参数为一个数组列表，可以同时传递多个参数
  key[参数1]
  key[参数1,参数2]
- 当参数有空格，用双引号；当参数有引号，用\进行转义；如name.check["my name\"Hello\""]
- key名称的定义范围：数字、大小写字母、下划线、-、.

### 自定义监控项

自定义语法格式

```shell
vim /etc/zabbix/zabbix_agentd.conf
UserParameter=key,command
或
UserParameter=key[*],command $1 $2...  #将[]的参数传递给命令的$1,$2...
```

例子：

```shell
vim /etc/zabbix/zabbix_agentd.conf
UnsafeUserParameters=1
Include=/etc/zabbix/zabbix_agentd.d/

vim /etc/zabbix/zabbix_agentd.d/get_os_version.conf
UserParameter=get.os.version,cat /etc/redhat-release

systemctl restart zabbix-agent

[root@zabbix-server ~]# zabbix_get -s 192.168.101.135 -k get.os.version
CentOS Linux release 7.6.1810 (Core)
```

2. 通过key去获取到监控的值

```shell
[root@zabbix-server ~]# zabbix_get -s 192.168.101.135 -k vm.memory.size[pavailable]
10.802734
```

### 监控项值的类型

1. 无符号整型，值是正数，无负数。例如监控端口是否存活，存活返回1，不存活返回0

2. 浮点型，值可以为负数、小数。例如监控cpu的idle值

3. character，字符串，最大255个字节

4. Text，字符串，无限制

### 在模板中创建监控项

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20211019002157.png" alt="image-20211019002156959" style="zoom:67%;" />

### 基础监控项

| 归类        | 名称                              | 键值                                                    | 推荐频率 |
| ----------- | --------------------------------- | ------------------------------------------------------- | -------- |
| 客户端      | zabbix客户端名称                  | agent.hostname                                          | 1h       |
|             | 客户端是否ping通                  | agent.ping                                              | 1m       |
|             | 客户端版本                        | agent.version                                           | 1h       |
|             | 客户端是否可用                    | zabbix[host,agent,available]                            | 1m       |
|             |                                   |                                                         |          |
| 网络(ddl)   | 网卡类型                          | vfs.file.contents[“/sys/class/net/{#IFNAME}/type”]      | 1h       |
|             | 运行状态                          | vfs.file.contents[“/sys/class/net/{#IFNAME}/operstate”] | 1m       |
|             | 网卡出接口每秒报文被丢弃数        | net.if.out[“{#IFNAME}”,dropped]                         | 3m       |
|             | 网卡进接口每秒报文被丢弃数        | net.if.in[“{#IFNAME}”,dropped]                          | 3m       |
|             | 网卡出接口每秒流量bps             | net.if.out[“{#IFNAME}”]                                 | 3m       |
|             | 网卡进接口每秒流量bps             | net.if.in[“{#IFNAME}”]                                  | 3m       |
|             | 网卡出接口每秒错误数据包数        | net.if.out[“{#IFNAME}”,errors]                          | 3m       |
|             | 网卡进接口每秒错误数据包数        | net.if.in[“{#IFNAME}”,errors]                           | 3m       |
|             |                                   |                                                         |          |
| 内存        | 系统中总共swap                    | system.swap.size[,total]                                | 1h       |
|             | 系统可用swap                      | system.swap.size[,free]                                 | 1m       |
|             | 系统可用swap百分比                | system.swap.size[,pfree]                                | 1m       |
|             | 系统总共内存                      | vm.memory.size[total]                                   | 1h       |
|             | 系统中可用内存                    | vm.memory.size[available]                               | 1m       |
|             | 系统可用内存百分比                | vm.memory.size[pavailable]                              | 1m       |
|             | 系统中已用内存百分比              |                                                         |          |
|             |                                   |                                                         |          |
| 系统信息    | 系统主机名                        | system.hostname                                         | 1h       |
|             | 系统本地时间                      | system.localtime                                        | 1h       |
|             | 操作系统架构                      | system.sw.arch                                          | 1h       |
|             | 系统版本信息                      | system.sw.os                                            | 1h       |
|             | 系统安装包信息                    | system.sw.packages                                      | 1h       |
|             | 系统详细信息                      | system.uname                                            | 1h       |
|             | 系统运行持续时间                  | system.uptime                                           | 1h       |
|             | 系统开机时间                      | system.boottime                                         | 1h       |
|             | 系统配置的最大文件描述符数        | kernel.maxfiles                                         | 1h       |
|             | 系统配置的最大进程数              | kernel.maxproc                                          | 1h       |
|             | 系统中总共进程数                  | proc.num                                                | 1m       |
|             | 系统中正在运行的进程数            | proc.num[,,run]                                         | 1m       |
|             | 登陆用户数                        | system.users.num                                        | 10m      |
|             | 系统中/etc/passwd文件的md5值      | vfs.file.cksum[/etc/passwd]                             | 15m      |
|             |                                   |                                                         |          |
| 磁盘（ddl） | 可用inode百分比                   | vfs.fs.inode[{#FSNAME},pfree]                           | 1m       |
|             | 磁盘总共空间                      | vfs.fs.size[{#FSNAME},total]                            | 1m       |
|             | 磁盘已用空间                      | vfs.fs.size[{#FSNAME},used]                             | 1m       |
|             | 磁盘已用空间百分比                | vfs.fs.size[{#FSNAME},pused]                            | 1m       |
|             |                                   |                                                         |          |
| cpu         | 系统cpu的1分钟负载                | system.cpu.load[all,avg1]                               | 1m       |
|             | 系统cpu的5分钟负载                | system.cpu.load[all,avg5]                               | 1m       |
|             | 系统cpu的15分钟内负载             | system.cpu.load[all,avg15]                              | 1m       |
|             | 系统cpu核心数                     | system.cpu.num                                          | 1h       |
|             | 系统cpu每秒中断数                 | system.cpu.intr                                         | 1m       |
|             | 系统cpu的每秒上下文切换数         | system.cpu.switches                                     | 1m       |
|             | 系统cpu用户空间使用百分比         | system.cpu.util[,user]                                  | 1m       |
|             | 系统cpu的io操作使用百分比         | system.cpu.util[,iowait]                                | 1m       |
|             | 系统cpu的硬中断使用百分比         | system.cpu.util[,interrupt]                             | 1m       |
|             | 系统cpu的空闲时间占用百分比       | system.cpu.util[,idle]                                  | 1m       |
|             | 系统cpu的软中断使用百分比         | system.cpu.util[,softirq]                               | 1m       |
|             | 系统cpu系统空间使用百分比         | system.cpu.util[,system]                                | 1m       |
|             | 系统cpu虚拟化使用百分比           | system.cpu.util[,steal]                                 | 1m       |
|             | 系统cpu进程优先级变更使用的百分比 | system.cpu.util[,nice]                                  | 1m       |