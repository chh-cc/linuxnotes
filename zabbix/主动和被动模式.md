# 主动模式和被动模式

Zabbix的监控分为主动和被动，这2个都是针对客户端说的。
默认为被动模式：server向agent（10050端口）请求数据，100个监控项要100个来回，要的时候才返回
主动模式：agent将采集的数据主动推送给server（10051端口），100个监控项1个回合，将所需要的100个打包，然后一次发过去，发过去之后，客户端全部执行完再一次返回给服务端。

## 被动模式

默认的监控项模板都是被动模式的，所以修改配置文件并套用模板即可

```shell
#指定pid文件位置
PidFile=/var/run/zabbix/zabbix_agentd.pid
#指定日志文件位置
LogFile=/var/log/zabbix/zabbix_agentd.log
#设置为被动模式，将开启端口
StartAgents=3
#当前的主机名，要写正确，否则服务端会不识别
Hostname=DEV-TEST
#服务端的地址，用逗号(,)可以隔开写多个
Server=192.168.1.100
#自定义的脚本超时时间，
Timeout=8
#允许自定义脚本
UnsafeUserParameters=1
#加载其它配置文件
Include=/etc/zabbix/zabbix_agentd.d/*.conf
```

## 主动模式

需要修改配置文件和模板，将监控项改为主动模式

```shell
#指定pid文件位置
PidFile=/var/run/zabbix/zabbix_agentd.pid
#指定日志文件位置
LogFile=/var/log/zabbix/zabbix_agentd.log
#设置为主动模式，将关闭被动模式，不监听端口
StartAgents=0
#当前的主机名，要写正确，否则服务端会不识别
Hostname=DEV-TEST
#服务端的地址，用逗号(,)可以隔开写多个
ServerActive=192.168.1.100
#自定义的脚本超时时间，
Timeout=8
#允许自定义脚本
UnsafeUserParameters=1
#加载其它配置文件
Include=/etc/zabbix/zabbix_agentd.d/*.conf
```

克隆模板：

完全克隆原来被动模式的模版为主动模式

​        ![img](https://gitee.com/c_honghui/picture/raw/master/img/20210425154545.png)        

​        <img src="https://gitee.com/c_honghui/picture/raw/master/img/20210425154559.png" alt="img" style="zoom:67%;" />        

取消链接

​        <img src="https://gitee.com/c_honghui/picture/raw/master/img/20210425154605.png" alt="img" style="zoom:67%;" />        

​        <img src="https://gitee.com/c_honghui/picture/raw/master/img/20210425154609.png" alt="img" style="zoom:67%;" />        

把模板关联到主机，然后重启主机的agent配置文件

查看最新数据，发现获取数据的时间都是一样的：

​        ![img](https://gitee.com/c_honghui/picture/raw/master/img/20210425154621.png)

## 综合配置

这样主动和被动都开启，监控项根据情况进行设置。

```shell
#指定pid文件位置
PidFile=/var/run/zabbix/zabbix_agentd.pid
#指定日志文件位置
LogFile=/var/log/zabbix/zabbix_agentd.log
#设置为被动模式，将开启端口
StartAgents=3
#当前的主机名，要写正确，否则服务端会不识别
Hostname=web2
#服务端的地址，用逗号(,)可以隔开写多个
Server=10.10.10.137
#服务端的地址，用逗号(,)可以隔开写多个
ServerActive=10.10.10.137
#自定义的脚本超时时间，
Timeout=8
#允许自定义脚本
UnsafeUserParameters=1
#加载其它配置文件
Include=/etc/zabbix/zabbix_agentd.d/*.conf
```

