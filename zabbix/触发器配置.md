# 触发器配置

告警流程:

host group->hosts->applications（监控项组）->items->triggers（触发器）->actions（告警动作）->medias（告警方式）->user groups->users

告警配置步骤：

配置trigger；配置用户；配置告警方式；配置action

## 触发器配置

trigger是一组逻辑表达式，用于判断item的数据与阈值是否相同。

触发器故障等级：灾难、危险、一般、警告、信息、不通知

触发器表达式：

{<host|template>:\<key>.\<function>(\<parameter>)}\<operator>\<constant>

示例：

{Zabbix  server:agent.ping.nodata(5m)}=1

函数：

```text
abschange
功能：求最近两值差的绝对值，常用于数值在一个范围波动的场合，如机房稳定温度常在23°
用法：
abschange()>N	#最近两值的差的绝对值大于N
abschange()<N
abschange()=N
abschange()<>N	#不等于
参数：不支持

delta
功能：求最大值与最小值的差，如系统最高负载和最低负载的差值
用法：
delta(sec|#num,<time_shift>)>N
delta(sec|#num,<time_shift>)<N
delta(sec|#num,<time_shift>)=N
delta(sec|#num,<time_shift>)<>N
例子：
delta(10m,1d)>10表示1天前的十分钟数据的最大值与最小值的差大于10
delta(#5,1d)>10表示1天前连续5个数据
delta(10m)>10表示最近十分钟内
delta(#5)>10表示最近连续5个数据
参数：
第一个参数为秒或#num
第二个参数为某个时间段前

diff
功能：判断最近两值是否相同，如检测主机名、系统版本是否发生改变
用法：
diff()=0	#最近两值相同
diff()=1	#最近两值不同
参数：不支持

change
功能：最近值与前一次值的差，可正可负，比如系统启动时间（uptime）小于上一次，说明系统重启
用法：
change()>N
change()<N
change()=N
change()<>N
参数：不支持

band
功能：将最近值和掩码按位运算

nodata
功能：检测一段时间内是否接收到数据，返回1表示没有接收到，0表示接收到数据
用法：
nodata(sec)
nodata(30s)=1	#30秒内没有接收到数据
参数：支支持一个时间参数，时间必须大于或等于30s，因为历史数据同步进程是每隔30秒执行一次这个函数
扩展：
由于网络抖动等原因经常造成故障误报，可以进行改进
{Template OS Linux:agent.ping.nodata(10m)}=1 and {Template OS Linux:agent.ping.last(#20,10m)}=1 and {Template OS Linux:agent.ping.last(#16,10m)}=1 and {Template OS Linux:agent.ping.last(#12,10m)}=1

last
功能：获取最近一段时间内或指定个数的数据，如求最近系统运行进程的数量
用法：
last(sec|#num,<time_shift>)
last(3m)=N	#最近3分钟数值等于N
last(#3)>N	#第3次的值大于Ｎ
last(#3,3m)<N	#最近3分钟第3次的值小于N
last(#3,3m)<>N
参数：第一个参数为秒或#num，第二个参数为某个时间段内

prev
功能：求前一个数据的值，等于last(#2)\
用法：
prev()=N
prev()>N
prev()<N
prev()<>N
参数：不支持
----------------------------------------------------------------------------------
max
功能：在指定一段时间内或指定数据个数，求最大值
用法：
max(5m)>N	#最近5分钟内最大值大于N
max(#3)<N
max(#3,10m)<>N	#十分钟前3次取值的最大值不等于N
参数：

min
功能：求最小值
用法：类似max

avg
功能：求平均值
用法：类似max

sum
功能：求和
用法：类似max

count
功能：统计个数
用法：
count(600)	#最近十分钟内数值的个数
count(600,12)	#最近十分钟内数值等于12的个数
count(10m,"error",eq)	#最近十分钟内字符串等于error的个数
count(600,12,gt)	#大于12
count(#10,12,gt)
count(#10,12,gt,1d)	#1天前的最近10个值大于12的个数
参数：第一个参数为秒或#num，第二个为匹配的数值或字符串，第三个为运算符，第四个为某个时间段前
```

## 依赖关系

触发器彼此之间可能会存在依赖关系的，一旦某一个触发器被触发了，那么依赖这个触发器的其余触发器都不需要再报警。

例如，当交换机挂掉，只有自己报警就可以了，其余的主机就不需要在报警了

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210802004106.png" alt="image-20210802004106097" style="zoom:67%;" />