# 命令

控制台使用技巧

基于我的运维工作经验给你汇总如下：

操作快捷键

Ctrl + r：可以快速查找历史命令；

Ctrl + l：可以清理控制台屏幕；

Ctrl + a \ Ctrl + e：移动光标到命令行首\行尾；

Ctrl + w \ Ctrl + k：删除光标之前\之后的内容。

VIM文件编辑快捷键

快捷键ZZ：文件保存并退出。

进程操作快捷键

Ctrl + c：强制终止程序的执行；

Ctrl + z：挂起一个进程；

Ctrl + d：终端中输入 exit 后回车。

linux命令中快捷键（top）

Shift + p：根据 CPU 使用率排序；

Shift + m：根据内存占用排序。



vmstat命令

```shell
r: 运行队列长度和正在运行的线程数（感觉不靠谱，不明白啥意思）；

b: 表示阻塞的进程数；

swpd: 虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器；

si: 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常。

so: 每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上；

bi: 块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byte，我本机上没什么IO操作，所以一直是0，但是我曾在处理拷贝大量数据(2-3T)的机器上看过可以达到140000/s，磁盘写入速度差不多140M每秒；

bo: 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整；

in: 每秒CPU的中断次数，包括时间中断；

cs: 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。

st: cpu在虚拟化环境上在其他租户上的开销;
```

&和nohup

```shell
sh test.sh &>> out.file &
使用&命令后，作业被提交到后台运行，当前控制台没有被占用，但是一但把当前控制台关掉(退出帐户时)，作业就会在后台当做一个进程使用。
nohup sh test.sh &>> out.file &
#使用了nohup之后，很多人就这样不管了，其实这样有可能在当前账户非正常退出或者结束的时候，命令还是自己结束了。所以在使用nohup命令后台运行命令之后，需要使用exit正常退出当前账户，这样才能保证命令一直在后台运行。
```

