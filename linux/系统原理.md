# 系统原理

## CPU

### 负载

用top可查看

平均负载是指单位时间内，处于可运行状态和不可中断状态的进程数。

平均负载并非使用率。cpu顶多100%，不可能120%使用率，但负载可以是200%，因为还有等待运行的进程。

当1分钟，5分钟，15分钟相差不大，说明系统很稳定
当1分钟小于15分钟，说明过去15分钟负载很高，当前正在降低
当1分钟大于15分钟，说明负载正在增加，过去15分钟负载比较低
当平均负载超过cpu核心数70%就要注意了，可能有大量任务堆积，需要排查。

### us和sy

用户 CPU使用率高，通常说明有应用程序比较繁忙。

系统 CPU 使用率高，说明内核比较繁忙。

### id

剩下的id就是除了id以为占用cpu时间片的空闲部分，相当于空间cpu的百分比。

### wa

wa指的是CPU等待磁盘写入完成的时间，就是说前提是要进行IO操作。

在进行IO操作的时候，如果程序是阻塞的，他cpu会等待数据写入磁盘才能完成写操作。所以这个时候cpu等待的时间就是wa。

举例：
使用cp复制，如果文件夹中有多个文件，他每复制一次，cpu就指挥文件复制，但是硬盘读写的时候，cpu是要等待的，这时候cpu不动作只是等待。

所以如果一台机器看到wa特别高，那么一般说明是磁盘IO出现问题，可以使用iostat等命令继续进行详细分析。

### 占用过高排查

1.在top中按P定位到占用CPU高的进程PID

2.通过ps aux | grep PID命令
获取线程信息，并找到占用CPU高的线程
`ps -mp pid -o THREAD,tid,time | sort -rn`

3.将需要的线程ID转换为16进制格式
`printf "%x\n" tid`

4.打印线程的堆栈信息 到了这一步具体看堆栈的日志来定位问题了
`jstack pid |grep tid -A 30`

## 进程

