# Redis入门简介

## 简介

Redis是一款开源的、高性能的键-值存储。它常被称作是一款数据结构服务器、缓存服务器。Rredis属于非关系型数据库和Memcached类似，Redis也是一种key-value型存储系统。

## 为什么使用redis?

**分析**:博主觉得在项目中使用redis，主要是从两个角度去考虑:**性能**和**并发**。当然，redis还具备可以做分布式锁等其他功能，但是如果只是为了分布式锁这些其他功能，完全还有其他中间件(如zookpeer等)代替，并不是非要使用redis。因此，这个问题主要从性能和并发两个角度去答。

### 性能

需要执行耗时特别久，且结果不频繁变动的SQL，就特别适合将运行结果放入缓存。这样，后面的请求就去缓存中读取，使得请求能够**迅速响应**。

### 并发

在大并发的情况下，所有的请求直接访问数据库，数据库会出现连接异常。这个时候，就需要使用redis做一个缓冲操作，让请求先访问到redis，而不是直接访问数据库。

### 缺点

主要是四个问题：
(一)缓存和数据库双写一致性问题
(二)缓存雪崩问题
(三)缓存击穿问题
(四)缓存的并发竞争问题

## 原理

命令结构

![file](https://cdn.jsdelivr.net/gh/chh-cc/linuxnotes//img/20210204225603.png)

- 1.客户端发送命令后，Redis服务器将为这个客户端链接创造一个’输入缓存’，将命令放到里面。
- 2.再由Redis服务器进行分配挨个执行，顺序是随机的，这将不会产生并发冲突问题，也就不需要事物了。
- 3.再将结果返回到客户端的’输出缓存’中，输出缓存先存到’固定缓冲区’，如果存满了，就放入’动态缓冲区’，客户端再获得信息结果。



Redis高性能原因

1.基于内存的访问，非阻塞I/O，Redis使用事件驱动模型**epoll多路复用**实现，连接、读写、关闭都转换为事件不在网络I/O上浪费过多的时间

```text
I/O多路复用机制
打比方：小明开一家同城快送店，有一辆车和一批快递员
经营方式一：
客户每送来一个快递，就分配给一个快递员，谁拿到车就开车去送
问题：
几十个快递员基本上时间都花在了抢车上了，大部分快递员都处在闲置状态，谁抢到了车，谁就能去送快递
随着快递的增多，快递员也越来越多，小曲发现快递店里越来越挤，没办法雇佣新的快递员了
快递员之间的协调很花时间
经营方式二：
只雇一个快递员，他把客户所有的快递都标注好放在一个地方，最后依次一个一个派送

每个快递员------------------>每个线程
每个快递-------------------->每个socket(I/O流)
快递的送达地点-------------->socket的不同状态
客户送快递请求-------------->来自客户端的请求
小曲的经营方式-------------->服务端运行的代码
一辆车---------------------->CPU的核数

于是我们有如下结论
1、经营方式一就是传统的并发模型，每个I/O流(快递)都有一个新的线程(快递员)管理。
2、经营方式二就是I/O多路复用。只有单个线程(一个快递员)，通过跟踪每个I/O流的状态(每个快递的送达地点)，来管理多个I/O流。
```

下面类比到真实的redis线程模型，如图所示

![image](https://cdn.jsdelivr.net/gh/chh-cc/linuxnotes//img/20210205002116.png)

2.**单线程**避免的高并发的时候，多线程有锁的问题和线程切换的CPU开销的问题。虽然是单线程的，我们还可以通过多实例来弥补。

3.使用C语言编写，更好的发挥服务器性能，并且代码简洁，性能高

