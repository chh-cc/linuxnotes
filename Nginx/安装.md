源码编译安装nginx：

```shell

	（1）源码编译安装需要开发编译环境；可以使用如下方法安装；
		yum groupinstall "Development tools" 
	（2）如果需要nginx支持url rewrite功能，则需要安装pcre组件；
		yum install pcre*
	（3）添加nginx用户、nginx组，用于nginx服务；
		useradd -r nginx
	（4）下载nginx源码包，解压并编译安装；
		tar xf nginx-1.12.1.tar.gz 
		cd nginx-1.12.1
		./configure 	--prefix=/usr/local/nginx \      【指定nginx程序工作目录】
					--user=nginx --group=nginx \
					--error-log-path=/usr/local/nginx/logs/error.log \
					--http-log-path=/usr/local/nginx/logs/access.log \
					--pid-path=/var/run/nginx/nginx.pid  \
					--lock-path=/var/lock/nginx.lock \
					--with-pcre \					【启用pcre以支持nginx的url rewrite】
					--with-http_ssl_module \			【启用nginx的ssl模块，该模块依赖openssl，所以需要安装openssl-devel包】
					--with-http_stub_status_module \    【启用nginx状态监控】
					--with-http_gzip_static_module \    【启用压缩静态内容的gzip模块】
					--with-http_flv_module \            【启用流媒体功能】
					--with-http_mp4_module \
					--http-client-body-temp-path=/var/tmp/nginx/client \   【指定http客户端请求临时文件存放目录，该目录需事先创建】
					--http-proxy-temp-path=/var/tmp/nginx/proxy \    【指定反向代理临时文件目录，该目录需事先创建】
					--http-fastcgi-temp-path=/var/tmp/nginx/fastcgi \  【fastcgi临时文件目录，该目录需要事先创建】
					--http-uwsgi-temp-path=/var/tmp/nginx/uwsgi \     【uwsgi临时文件目录，该目录需事先创建】
		make && make install
		
		mkdir -pv /var/tmp/nginx/{client,proxy,fastcgi.uwsgi}     【创建这些临时文件目录】
		
	（5）启动nginx；
		默认情况，自己指定路径安装，系统无法找到nginx二进制程序的路径；
		所以想要启动nginx有以下两种方法：
		<1>/usr/local/nginx/sbin/nginx		【命令全路径】
		<2>将nginx的二进制程序路径加入到PATH变量中，使得系统能够找到；
			vim /etc/profile.d/nginx.sh
				export NGINX_HOME=/usr/local/nginx
				export PATH=$PATH:$NGINX_HOME/sbin
				
			. /etc/profile.d/nginx.sh  【加载nginx.sh文件，这样系统就能找到nginx二进制程序路径了】
			
			nginx 【直接启动nginx】
```



平滑升级：

1. 查看当前版本，有哪些模块，将模块复制粘贴

```shell
[root@nginx ~]# nginx -V
```

2. 下载新版本

```shell
[root@nginx ~]# yum install gcc gcc-c++ automake pcre pcre-devel zlip zlib-devel openssl openssl-devel 
[root@nginx ~]# wget http://nginx.org/download/nginx-1.10.3.tar.gz
[root@nginx ~]# tar -xf nginx-1.10.3.tar.gz
[root@nginx ~]# cd nginx-1.10.3
```

3. 升级

先./configure 再make，不要install，否则覆盖

```shell
[root@nginx ~]# ./configure --xx --xx
[root@nginx ~]# make
```

4. 替换

当前目录objs目录下一个nginx文件，那就是nginx -V时的命令

将旧的备份

```shell
[root@nginx ~]# mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak
```

复制新的

```shell
[root@nginx ~]# cp objs/nginx /usr/local/nginx/sbin/
```

5. 验证

```shell
[root@nginx ~]# cd /usr/local/nginx/sbin/
[root@nginx ~]# nginx -t
[root@nginx ~]# nginx -s reload
[root@nginx ~]# nginx -V
```

