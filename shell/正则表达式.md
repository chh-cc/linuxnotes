# shell三剑客

## 正则表达式

为处理大量字符串而定义的一套规则和方法，可以快速过滤替换需要的字符串，linux一般以行为单位处理。

### 基础正则表达式

```shell
^word //匹配以word开头的行
word$ //匹配以word结尾的行
^$ //匹配空行
. //任意一个字符
\ //转义
* //匹配0个或多个前面的一个字符
.* //匹配所有字符
[abc] //匹配括号任意一个字符
[^abc] //不包含abc字符
a\{n,m\} //重复前一个字符n到m次，用egrep可以去掉斜线
\{n,\} //重复至少n次，用egrep可以去掉斜线
```

### 扩展正则表达式

 ```shell
+ //匹配前面正则表达式的 1 个或多个字符
? //匹配前面正则表达式的 0 个或 1 个字符
 ```

### 场景

```shell
^[0-9]+$ #匹配数字
[a-z0-9]+@[a-z0-9]+\.[a-z]+ #匹配邮箱
([0-9]{1,3}\.){3}\.[0-9]{1,3} #匹配IP
```

## grep

grep: 在文件中全局查找指定的正则表达式，并打印所有包含该表达式的行

egrep: 扩展的egrep，支持更多的正则表达式元字符

格式：

```shell
grep [选项] PATTERN filename 
```

参数：

```shell
与正则表达式相关的选项
-E 支持扩展正则
-e 用 PATTERN 来进行匹配操作
-i 忽略大小写
-w 匹配整个单词
-x 匹配一整行

输出控制选项
-m 输出匹配前m个结果

文件控制选项
-n 标示出该行的列数编号
-o 只输出匹配内容
-c 只输出匹配的行数
-v 打印不匹配的行
```

实例：

```shell
查找进程
ps -ef | grep svn
进程个数
ps -ef|grep -c svn
查找关键字
grep 'linux' test.txt
grep -E roo+ /etc/passwd
```

## sed

格式：

```shell
sed [选项] '地址 命令' file
```

选项：

```shell
-n 不打印模式空间,加上-n参数后，则只有经过sed特殊处理的那一行（或者command）才会被列出来。
-e 允许多点编辑
-f 执行动作从文件读取执行
-i 修改原文件
-r 使用扩展正则表达式
```

地址：

```shell
/regexp/ 正则表达式匹配行
number 只匹配指定行
addr1,addr2 开始匹配 addr1 行开始，直接 addr2 行结束
addr1,+N 从 addr1 行开始，向后的 N 行
addr1,~N 从 addr1 行开始，到 N 行结束
```

命令：

```shell
a\	新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)；
c\	取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行；
d	删除，因为是删除啊，所以 d 后面通常不接任何咚咚；
i\	插入， i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)；
p	打印，亦即将某个选择的资料印出。通常 p 会与参数 sed -n 一起运作；
s	取代，可以直接进行取代的工作哩！通常这个 s 的动作可以搭配正规表示法！例如1,20s/old/new/g 就是啦；
```

打印第一行：
sed -n '1p'
打印匹配行和后一行：
sed -n '/blp5/,+1p'
打印最后一行：
sed -n '$p'
替换 blp5 字符串为 test
sed 's/blp5/test/'
对 1-4 行的 blp5 进行替换
sed '1,4s/blp5/test'
注释:
sed 's/^/#/'
在 blp5 下一行添加 test:
sed '/blp5/a\text'
将 blp5 替换新行:
sed '/blp5/c\text'

删除配置文件的注释#
sed -ri '/^#/d'
sed -ri '/^[ \t]*#/d'
删除无内容空行
sed -ri '/^[ \t]*$/d'
删除注视行和空行
sed -ri '/^[ \t]*#/d;/^[ \t]*$/d'
sed -ri '/^[ \t]*(#|$)/d'
修改文件
sed -ri '/^SELINUX=/cSELINUX=disabled' /etc/selinux/config
sed -ri '$a\chroot_local_user=YES' /etc/vsftpd/vsftpd.conf
给文件添加注释
sed -ri '2,6s/^/#/'