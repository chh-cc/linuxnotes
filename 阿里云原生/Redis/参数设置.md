## AOF落盘

云数据库Redis版默认开启AOF落盘，即基于AOF（append-only file）的数据持久化。您可以通过设置**appendonly**参数来关闭或重新开启AOF落盘。

云Redis的AOF持久化策略为AOF_FSYNC_EVERYSEC，系统每秒将接收到的**写入类命令记录到AOF，保存在磁盘中**，因此又称为AOF落盘。这种策略对Redis服务性能的影响较小，同时也能极大地降低意外情况下的数据损失风险。云Redis支持AOF增量归档，避免了AOF Rewrite对服务性能的影响。

AOF落盘会带来一定写性能损耗，如果将Redis实例应用于纯缓存场景中，对数据持久化没有需求，可以关闭AOF落盘

无需重启实例，已有的AOF日志不受影响

- 标准版实例中仅主节点的AOF落盘关闭，replica不受影响。
- 集群版实例中所有数据分片的主节点均关闭AOF落盘，所有从节点不受影响。
- 读写分离版实例中主节点与所有只读副本的AOF落盘关闭，从节点不受影响。

## 调整定期任务的执行频率

通过修改**hz**参数的值，您可以调整Redis执行定期任务的频率，从而改变Redis清除过期key、清理超时连接的效率。

典型应用场景：

Redis会通过执行定期任务来主动清除过期key，如果过期key数量很多或者增加速度很快，而Redis的主动清除频率较低，**过期key将占用大量的内存空间，可能会影响Redis服务的性能**。适当调整**hz**参数的值，提高清除频率，能够很好地解决这个问题。

增大**hz**参数的值会提升各项定期任务的执行频率，但也会提高Redis服务的CPU使用率。

## 设置客户端超时时间

默认设置下，即使某个客户端已经空闲了很长时间，Redis也不会主动断开与该客户端的连接。但在业务核心应用中，建议配置**timeout**参数以使Redis具有主动回收资源的能力。否则，如果客户端出现异常，连接池资源将无法及时回收，可能因空闲连接占满连接池导致服务崩溃。

在实际运行中，为了提高性能，Redis不一定会精确地按照**timeout**参数值的时间来断开符合条件的空闲连接，例如设置**timeout**参数值为10s，但空闲连接可能在12s后，服务器中新增很多连接时才会被断开。如需降低这个延迟，可适当增大**hz**参数的值，提高负责断开超时连接等定时任务的运行频率。