## RDS简介

RDS MySQL 内核是阿里云深度定制的独立 MySQL 分支 AliSQL



**RDS MySQL 具有的特性:**

(1) Statement ConcurrencyContrl 可以**控制 MySQL 的并发**，当遇到数据负载 CPU较高，是由某条 MySQL 引起并发数过多，导致整个数据库负载增加时，可以用这个功能去匹配这条 SQL 的关键字，将这条 SQL 进行并发控制，把它限制在一条或两条等。这个功能就可以在应急场景上使用。 

(2) Statement Outline 可以指定执行某些搜索的执行计划和回收。比如说要删除一个表时，出现了误删除，可以**从回收站进行回收**。

## 规格架构

RDS MySQL 产品系列目前有三个版本：

1. 基础版：基础版是单节点实例；采用的是计算与存储分离的架构，性价比超高，更适合于个人的学习或者微型的网站或者中小型企业的开发测试环境。

2. **高可用版**：采用的是一主一备的经典高可用架构，试用于80%的用户场景，像大中型的生产数据库，互联网、物联网等这些行业的数据库。

   **从库是隐藏的高可用节点，不提供服务**

3. 三节点企业版：采用的是一主两备的三节点架构，通过多副本的同步复制，确保数据的强一致性，提供金融级的可靠性。对数据安全性要求非常高的金融、证券、保险行业的核心数据或者各大行业企业的核心生产数据，可以使用三节点企业版。



只读实例：

在少量写大量读的场景，单实例可能无法承受读取压力，可以创建一个或多个只读实例。

**直接释放只读实例会影响业务**，建议先把只读实例的读权重设置为0，然后再释放实例。之前缓存的连接还会连接到该只读实例，需要重新建立连接才会路由到其他只读实例。

重启实例会造成**30秒左右**的连接中断，如果主实例包含只读实例，重启实例**不会重启只读实例**，复制关系将在重启后自动恢复。

可创建的只读实例数量：10个。

## 连接和授权

创建RDS MySQL实例后，暂时无法访问实例。您需要设置RDS MySQL实例的**IP白名单或安全组**。

在RDS白名单中添加安全组后，该安全组中的ECS实例就可以访问RDS实例。



RDS不提供root账号或具有super权限的账号；通过**命令可以进行更细粒度的授权**

主实例账号会同步到只读实例，只读实例无法管理账号，账号在只读实例只能读操作

## 变配

### 变更配置

变更系列、规格、存储空间



只读实例的存储空间必须大于或等于其所属主实例的存储空间。建议您先扩容只读实例的存储空间，所有只读实例扩容完成后，再扩容主实例存储空间。

变配会出现**约30秒的闪断**，请在业务低峰期进行变配，并确保您的应用有自动重连机制。

升级主实例时，只读实例不会跟着自动升级



变更配置地址会改变？

实例的连接地址（如rm-bpxxxxx.mysql.rds.aliyuncs.com）不会变化，但是对应的IP地址可能会变化

### 主备切换

默认自动切换，也可以手动切换，主备切换后不需要手动切换回主实例

主备实例切换过程中会出现闪断

如果实例下挂载有只读实例，那么主备实例切换后，只读实例的数据会有几分钟的延迟，因为需要重建复制链路、同步增量数据等

只有集群版实例的备实例可以访问，其他系列的备实例不可以访问

### 修改复制方式

高可用版本支持：**半同步和异步**，集群版多了一个组同步

半同步：备实例收到日志，事务就算提交完成，不需要等备实例执行日志内容

异步：主实例完成增删改操作后立即响应应用，同时向备实例异步复制数据，主实例不可用时可能会导致主备实例数据不一致。

根据您的业务需求进行选择。如果需要确保数据的强一致性，实现金融级的可靠性，建议您使用组复制（仅集群版实例支持）；如果要求极高的响应速度，建议您使用异步；其他情况下可以使用折中的方案，即半同步。

## RDS参数

命令查看参数：

```mysql
#查看当前实例的所有参数配置
SHOW VARIABLES;
#查看指定参数的配置, <参数名称>中可使用百分号（%）进行模糊查询
SHOW VARIABLES LIKE '<参数名称>';
SHOW VARIABLES LIKE 'thread_cache%';表示查询以thread_cache开头的所有参数
```



仅支持对控制台中开放的参数进行修改

部分参数在主实例被修改后会自动同步到该主实例下的所有只读实例

部分参数修改后不需要重启实例，通常5分钟左右可以生效



修改最大连接数：

- **max_user_connections**：用户最大连接数，表示任意一个账号的连接数上限，设置范围为[10~208000]。如果同一个账号的连接数超过上限，系统会报错`has more than 'max_user_connections'`或`has exceeded the 'max_user_connections'`，新的连接将无法建立。
- **max_connections**：最大连接数，表示所有账号连接数之和的上限，设置范围为[1~208000]。如果总连接数超出上限，系统会报错`too many connections`，新的连接将无法建立。

连接占用内存，连接数越大，消耗实例资源就越多，您需谨慎设置。如果max_connections设置过大，容易造成内存溢出。因此，推荐使用实例当前规格默认的最大连接数值，避免因连接数配置超过实际实例的负载承受能力范围，影响实例的稳定性。



