## RDS简介

RDS MySQL 内核是阿里云深度定制的独立 MySQL 分支 AliSQL



**RDS MySQL 具有的特性:**

(1) Statement ConcurrencyContrl 可以**控制 MySQL 的并发**，当遇到数据负载 CPU较高，是由某条 MySQL 引起并发数过多，导致整个数据库负载增加时，可以用这个功能去匹配这条 SQL 的关键字，将这条 SQL 进行并发控制，把它限制在一条或两条等。这个功能就可以在应急场景上使用。 

(2) Statement Outline 可以指定执行某些搜索的执行计划和回收。比如说要删除一个表时，出现了误删除，可以**从回收站进行回收**。

## 规格架构

RDS MySQL 产品系列目前有三个版本：

1. 基础版：基础版是单节点实例；采用的是计算与存储分离的架构，性价比超高，更适合于个人的学习或者微型的网站或者中小型企业的开发测试环境。

2. **高可用版**：采用的是一主一备的经典高可用架构，试用于80%的用户场景，像大中型的生产数据库，互联网、物联网等这些行业的数据库。

   **从库是隐藏的高可用节点，不提供服务**

3. 三节点企业版：采用的是一主两备的三节点架构，通过多副本的同步复制，确保数据的强一致性，提供金融级的可靠性。对数据安全性要求非常高的金融、证券、保险行业的核心数据或者各大行业企业的核心生产数据，可以使用三节点企业版。



只读实例：

在少量写大量读的场景，单实例可能无法承受读取压力，可以创建一个或多个只读实例。

**直接释放只读实例会影响业务**，建议先把只读实例的读权重设置为0，然后再释放实例。之前缓存的连接还会连接到该只读实例，需要重新建立连接才会路由到其他只读实例。

重启实例会造成**30秒左右**的连接中断，如果主实例包含只读实例，重启实例**不会重启只读实例**，复制关系将在重启后自动恢复。

可创建的只读实例数量：10个。



复制方式：

高可用版本支持：**半同步和异步**

半同步：备实例收到日志，事务就算提交完成，不需要等备实例执行日志内容

异步：主实例完成增删改操作后立即响应应用，同时向备实例异步复制数据，主实例不可用时可能会导致主备实例数据不一致。

## 连接和授权

创建RDS MySQL实例后，暂时无法访问实例。您需要设置RDS MySQL实例的**IP白名单或安全组**。

在RDS白名单中添加安全组后，该安全组中的ECS实例就可以访问RDS实例。



RDS不提供root账号或具有super权限的账号；通过**命令可以进行更细粒度的授权**

主实例账号会同步到只读实例，只读实例无法管理账号，账号在只读实例只能读操作

## 变配

升级主实例配置：

只读实例不会自动升级，升级过程中仅在切换时会30秒闪断



变更配置地址会改变？

内网/外网地址和读写分离地址不会改变，但对应的ip地址可能会改变

## RDS参数模板

参数模板主要是基于数据安全性和写入性能。

| 模板           | 数据复制方式 | 数据保护参数                                      | 特点                         |
| -------------- | ------------ | ------------------------------------------------- | ---------------------------- |
| 默认参数模板   | 半同步       | Innodb_flush_log_at_trx_commit=1;sync_binlog=1    | 数据安全性最高，写入性能较慢 |
| 异步参数模板   | 异步         | Innodb_flush_log_at_trx_commit=1;sync_binlog=1    | 数据安全性较高，写入性能较快 |
| 高性能参数模板 | 异步         | Innodb_flush_log_at_trx_commit=2;sync_binlog=1000 | 数据安全性一般，写入性能最好 |

Innodb_flush_log_at_trx_commit

=1：事务提交时，每个事务的日志从缓冲区写到日志的是立刻进行写的，只要有事务完成了，它就**会立刻写盘**

=2：事务提交时，事务日志从缓冲区写到日志文件，但不会立刻写到磁盘，后台会每1s刷新到磁盘，当出现系统崩溃时，可能会丢失最后1s的数据

sync_binlog

=N：多少次写操作刷新一次binlog到磁盘，=1最安全

复制模式

半同步：更新在主实例执行完成后，会将日志同步到备实例，**备实例收到日志后事务就算完成提交**，不需要等备实例执行日志内容。当备实例不可用或者主备实例间出现网络异常，半同步会退化为异步

异步：**更新在主实例执行完成后会立即响应应用**，同时主实例向备实例异步复制数据，因此备实例不可用时不会影响主实例上的操作

