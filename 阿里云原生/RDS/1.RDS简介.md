## RDS简介

RDS MySQL 内核是阿里云深度定制的独立 MySQL 分支 AliSQL



## 规格架构

高可用版本：提供主备复制架构，备节点不提供服务

只读实例：少写多读的场景下，单个实例可能无法承受读取压力，可以创建一个或多个只读实例

读写分离：在只读实例的基础上，额外提供了一个读写分离地址，应用程序只需连接读写分离地址进行数据读取及写入操作，读写分离程序会自动将写入请求发往主实例，而将读取请求按照权重发往各个只读实例。

## 连接和授权

创建RDS MySQL实例后，暂时无法访问实例。您需要设置RDS MySQL实例的**IP白名单或安全组**。

在RDS白名单中添加安全组后，该安全组中的ECS实例就可以访问RDS实例。



RDS不提供root账号或具有super权限的账号；通过**命令可以进行更细粒度的授权**

主实例账号会同步到只读实例，只读实例无法管理账号，账号在只读实例只能读操作

## 变配

### 变更配置

变更系列、规格、存储空间



只读实例的存储空间必须大于或等于其所属主实例的存储空间。建议您先扩容只读实例的存储空间，所有只读实例扩容完成后，再扩容主实例存储空间。

变配会出现**约30秒的闪断**，请在业务低峰期进行变配，并确保您的应用有自动重连机制。

升级主实例时，只读实例不会跟着自动升级



变更配置地址会改变？

实例的连接地址（如rm-bpxxxxx.mysql.rds.aliyuncs.com）不会变化，但是对应的IP地址可能会变化

### 主备切换

默认自动切换，也可以手动切换，主备切换后不需要手动切换回主实例

主备实例切换过程中会出现闪断

如果实例下挂载有只读实例，那么主备实例切换后，只读实例的数据会有几分钟的延迟，因为需要重建复制链路、同步增量数据等

只有集群版实例的备实例可以访问，其他系列的备实例不可以访问

### 修改复制方式

高可用版本支持：**半同步和异步**，集群版多了一个组同步

半同步：备实例收到日志，事务就算提交完成，不需要等备实例执行日志内容

异步：主实例完成增删改操作后立即响应应用，同时向备实例异步复制数据，主实例不可用时可能会导致主备实例数据不一致。

根据您的业务需求进行选择。如果需要确保数据的强一致性，实现金融级的可靠性，建议您使用组复制（仅集群版实例支持）；如果要求极高的响应速度，建议您使用异步；其他情况下可以使用折中的方案，即半同步。

## RDS参数

命令查看参数：

```mysql
#查看当前实例的所有参数配置
SHOW VARIABLES;
#查看指定参数的配置, <参数名称>中可使用百分号（%）进行模糊查询
SHOW VARIABLES LIKE '<参数名称>';
SHOW VARIABLES LIKE 'thread_cache%';表示查询以thread_cache开头的所有参数
```



仅支持对控制台中开放的参数进行修改

部分参数在主实例被修改后会自动同步到该主实例下的所有只读实例

部分参数修改后不需要重启实例，通常5分钟左右可以生效



修改最大连接数：

- **max_user_connections**：用户最大连接数，表示任意一个账号的连接数上限，设置范围为[10~208000]。如果同一个账号的连接数超过上限，系统会报错`has more than 'max_user_connections'`或`has exceeded the 'max_user_connections'`，新的连接将无法建立。
- **max_connections**：最大连接数，表示所有账号连接数之和的上限，设置范围为[1~208000]。如果总连接数超出上限，系统会报错`too many connections`，新的连接将无法建立。

连接占用内存，连接数越大，消耗实例资源就越多，您需谨慎设置。如果max_connections设置过大，容易造成内存溢出。因此，推荐使用实例当前规格默认的最大连接数值，避免因连接数配置超过实际实例的负载承受能力范围，影响实例的稳定性。



