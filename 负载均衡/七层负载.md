# 七层负载均衡

七层负载原理：

{client}—CIP|DIP|HTTP→DIP{nginx}DIP—DIP|RIP|HTTP→{real server}

{real server}—RIP|DIP→DIP{nginx}DIP—DIP|CIP→{client}

- 客户端请求数据包报文的源地址时CIP，之不过在实际应用中，这里访问的目标地址并不是DIP+IP端口，而是URL
- 负载均衡在用户空间接收数据包，并且负载均衡和后端服务器发起新的TCP三次握手，建立新的连接。这时报文的源地址是DIP，目标地址是RIP，还有客户端请求的目标URL
- 后端服务器收到后响应请求并返回给负载均衡
- 然后负载均衡将响应内容重新打包并返回给客户端

场景：

- 七层作用在http层，所以七层只能跟tomcat、php等web服务做负载

- 可以根据请求的域名来做转发，比如请求访问A域名就转发到A服务器，这个功能在七层叫虚拟主机
- 可以根据URL做转发，比如请求的URL包含A目录就转发到A服务器
- 可根据浏览器类型做转发