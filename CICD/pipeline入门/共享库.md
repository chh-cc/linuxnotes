#  共享库

在Jenkins中使用Groovy语法，共享库中存储的每个文件都是一个groovy的类，每个文件（类）中包含一个或多个方法。每个方法包含groovy语句块。

## 使用共享库

我们导航到 系统配置 ->  `Global Pipeline Libraries`

首先，我们为共享库设置一个名称`jenkinslib`，注意这个名称后续在Jenkinsfile中引用。 再设置一个默认的版本，这里的版本是分支的名称。我默认配置的是`master`版本。

![image-20210329170224655](https://gitee.com/c_honghui/picture/raw/master/img/20210329170338.png)

接下来我们配置共享库的仓库地址，我的仓库在github中，所以这里我填写的是github的方式。（如果你用的是gitlab可以使用gitlab方式或者git方式）。如果仓库是私有的方式，需要在jenkins的凭据中添加一个账号用于下载共享库。

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210329170417.png" alt="image-20210329170416871" style="zoom:67%;" />

好，到此共享库在Jenkins的配置就完成了，接下来测试在Jenkinsfile中引用。

在Jenkinsfile中使用`@Library('jenkinslib') _ `来加载共享库，注意后面符号`_`用于加载。 
类的实例化`def tools = new org.devops.tools()`,使用类中的方法`tools.PrintMes("获取代码",'green')`。

```groovy
#!groovy

@Library('jenkinslib') _     

def tools = new org.devops.tools()

pipeline {
    agent { node {  label "master" }}

    stages {
        //下载代码
        stage("GetCode"){ 
            steps{  
                timeout(time:5, unit:"MINUTES"){   
                    script{ 
                        tools.PrintMes("获取代码",'green')
                    }
                }
            }
        }
    }
}
```

