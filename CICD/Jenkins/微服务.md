传统的典型单体架构应用就是将一个应用中所有的功能都打包在一个war文件中，然后部署在应用服务器（tomcat）中。

微服务架构从结构上来看就是将一个应用拆分成多个松耦合的服务，这些服务之间通过某种协议（REST、RPC等）进行互相协作，完成原单体i爱狗下的业务功能，但提供更灵活的部署模式，更容易扩展。

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20210328152016.png" alt="image-20210328152009758" style="zoom:67%;" />



## Spring Boot

构建微服务应用的框架

## Spring Cloud

**服务治理**

同一个微服务可能同时存在多个实例，它们如何通信？使用物理地址显然不行，不知道服务提供者到底在哪个服务器。解决方案是服务治理（服务注册及服务发现）

通过服务发现，消费者仅通过相应的服务名称就可以实现服务调用。服务注册机制可以让服务提供者在上线时将所提供的服务信息注册到服务治理服务器中。当服务下线时将自己从服务治理服务器中注销。

在微服务架构中负载均衡不仅仅指用户请求入口，还包含微服务之间的调用。

**服务网关**

微服务是众多的，而且大部分会对外提供某种服务接口，API服务网关就是为微服务提供了一个统一入口











build.sh

```shell
#!/bin/bash
#进入脚本所在目录，然后返回项目根目录
scriptPath="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd $scriptPath
cd ..
#服务器ssh配置
sshIP=
sshUsr=
sshPwd=
sshPort=
#Docker基本信息
dockerName="servdiscovery"
#对微服务应用进行编译打包
mvn clean package
#复制jar包到目录
outputPath="${scriptPath}/${dockerName}"
if [ -d ${outputPath} ];then
    rm -rf ${outputPath}
fi
mkdir ${outputPath} && mkdir ${outputPath}/jar
#将所生成的jar文件复制到指定目录
cp ./target/*.jar ${outputPath}/jar/app.jar
cp ${scriptPath}/release-docker.sh ${outputPath}/release-docker.sh
#删除服务器已存在的目录
cd ${scriptPath}
appPath="~/springcloud"
ssh -p ${sshPwd} ${sshUsr}@${sshIP} "[ -d ${appPath}/${dockerName} ]&&rm -rf ${appPath}/${dockerName}"
ssh -p ${sshPwd} ${sshUsr}@${sshIP} "[ -d ${appPath}/${dockerName} ]||mkdir -p ${appPath}/${dockerName}"
#将整个目录上传到服务器
scp -r -P ${sshPort} ./${dockerName} ${sshUsr}@${sshIP}:${appPath}
#远程执行发布命令
ssh -p ${sshPwd} ${sshUsr}@${sshIP} "sh ${appPath}/${dockerName}/release-docker.sh"
```

release-docker.sh

```shell
#!/bin/bash
#Docker基本信息
dockerName="servdiscovery"
dockerPort="8260"
#挂载路径建议绝对路径
dockerJarVolumn="/home/hucw/springcloud/${dockerName}"
#停止删除现有容器
echo "停止删除容器：${dockerName}"
docker stop ${dockerName} && docker rm ${dockerName}
#docker容器运行命令
echo ""
docker run --name=${dockerName} -d \
-p ${dockerPort}:${dockerPort} \
-v ${dockerjarVolumn}/jar:/jar \
microserv/openjdk:1.0.0
echo "${dockerName}容器已启动"

docker logs --tail=500 ${dockerName}
```







































