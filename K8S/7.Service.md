# Service

每个pod都有自己的ip地址，也可以被访问，可是pod一旦被更新、被删除后重新创建，ip地址就改变了，所以引入service这个概念

k8s主要是弹性部署，如果在同一节点创建了一个相同ip的pod会引起冲突 ，而且重新创建的pod可能在不同的节点，不同节点地址段可能不一样

Service是一种可以访问 Pod逻辑分组的策略， Service通常是**通过 Label Selector访问 Pod组**

## 服务之间是如何调用的

东西流量：

k8s给java1创建了一个java1-svc，给java2创建了一个java2-svc

java1通过http://java2-svc:port访问java2

![image-20211123002729816](https://gitee.com/c_honghui/picture/raw/master/img/20211123002736.png)

南北流量：

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20211123003841.png" alt="image-20211123003841007" style="zoom:67%;" />

## 定义一个service

创建一个svc的同时会创建一个同名的endpoint，endpoint记录了svc关联pod的ip地址；pod更新后ip地址改变，endpoint的地址也会刷新

查看endpoint：

```shell
kubectl get ep -n kube-system
```

## service类型

`spec.type`:

ClusterIP：默认值，在集群内部使用的IP，其他pod可以通过这个ip访问到该pod组

ExternalName：指定一个外部的域名

NodePort：在所有安装

## 使用service代理k8s外部应用

希望在生产环境使用某个固定的名称而非ip进行访问外部的中间件服务

某个项目正在迁移到k8s集群，但是一部分服务仍在集群外部