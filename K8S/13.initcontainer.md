# initContainer

## 初始化容器

init container的运行方式与应用容器不同，它们必须先于应用容器执行完成，当设置了多个init container时，将按顺序逐个运行，并且只有前一个init container运行成功后才能运行后一个init container。当所有init container都成功运行后，Kubernetes才会初始化Pod的各种信息，并开始创建和运行应用容器

若初始化容器运行失败，那么k8s需要重启它知道成功完成。如果Pod的spec.restartPolicy字段值为”Never“，那么运行失     败的初始化容器不会被重启。

```yaml
spec:
  template:
    spec:
      containers:
      - image: quay.io/fluentd_elasticsearch/elasticsearch:v7.4.2
        name: elasticsearch-logging
      # Elasticsearch requires vm.max_map_count to be at least 262144.
      # If your OS already sets up this number to a higher value, feel free
      # to remove this init container.
      initContainers:
      - image: alpine:3.6
        command: ["/sbin/sysctl", "-w", "vm.max_map_count=262144"]
        name: elasticsearch-logging-init
        securityContext:
          privileged: true
```

查看pod状态

```shell
[root@k8s-master01 ~]# kubectl get po
NAME                     READY   STATUS     RESTARTS   AGE
nginx-56c85c44b5-685kl   0/2     Init:0/1   0          5s
nginx-56c85c44b5-jd4w9   0/2     Init:0/1   0          5s
nginx-56c85c44b5-k2v84   0/2     Init:0/1   0          5s
```

## 生命周期的钩子函数

postStart：于容器创建完成之后立即运行的钩子处理器（handler），不过Kubernetes无法确保它一定会在容器中ENTRYPOINT之前运行。