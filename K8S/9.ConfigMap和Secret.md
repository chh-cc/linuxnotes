# ConfigMap和Secret

## configmap

一般用于管理一些配置文件，或者一些大量的环境变量信息

让镜像 和 配置文件解耦，以便实现镜像的可移植性和可复用性

### 使用kubectl创建configmap

```shell
#创建本地目录
mkdir configmap
cd configmap;mkdir -p configure-pod-container/configmap/
# 将实例文件下载到 `configure-pod-container/configmap/` 目录
wget https://kubernetes.io/examples/configmap/game.properties -O configure-pod-container/configmap/game.properties
wget https://kubernetes.io/examples/configmap/ui.properties -O configure-pod-container/configmap/ui.properties
# 创建 configmap
kubectl create configmap game-config --from-file=configure-pod-container/configmap/
#显示 ConfigMap 的详细信息：
kubectl describe configmaps game-config

Name:         game-config
Namespace:    default
Labels:       <none>
Annotations:  <none>

Data
====
game.properties:
----
enemies=aliens
lives=3
enemies.cheat=true
enemies.cheat.level=noGoodRotten
secret.code.passphrase=UUDDLRLRBABAS
secret.code.allowed=true
secret.code.lives=30
ui.properties:
----
color.good=purple
color.bad=yellow
allow.textmode=true
how.nice.to.look=fairlyNice
```

### 定义环境变量

定义configmap

```yaml
vim configmap.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: special-config
  namespace: default
data:
  special.how: very
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: env-config
  namespace: default
data:
  log_level: INFO
```

创建configmap

```shell
kubectl create -f configmaps.yaml
```

在pod中定义环境变量

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: dapi-test-pod
spec:
  containers:
    - name: test-container
      image: k8s.gcr.io/busybox
      command: [ "/bin/sh", "-c", "env" ]
      env:
        - name: SPECIAL_LEVEL_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.how
        - name: LOG_LEVEL
          valueFrom:
            configMapKeyRef:
              name: env-config
              key: log_level
  restartPolicy: Never
```

## Secret

用来保存敏感信息，比如密码、令牌或key、redis、mysql密码

### 使用kubectl创建secret

Secret 中可以包含 Pod 访问数据库时需要的用户凭证信息。可以将用户名和密码保存在本地机器的 `./username.txt` 和 `./password.txt` 文件里

```shell
# 创建本例中要使用的文件
echo -n 'admin' > ./username.txt
echo -n '1f2d1e2e67df' > ./password.txt
# 创建secret
kubectl create secret generic db-user-pass --from-file=./username.txt --from-file=./password.txt
# 查看secret
kubectl get secrets
```

### 手动创建secret

```yaml
# 将字段转换为base64
echo -n 'admin' | base64
echo -n '1f2d1e2e67df' | base64
# 创建secret
vim ./secret.yaml

apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
  
kubectl apply -f ./secret.yaml
```

### ImagePullSecret

pod拉取私有镜像仓库时使用的账号密码

创建一个docker registry的sercet

```shell
kubectl create secret docker-registry docker-secret --docker-server=hub.docker.com --docker-username=DOCKER_USER --docker-password=DOCKER_PASSWORD -docker-email=DOCKER_EMAIL
```

