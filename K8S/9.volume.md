# Volume

https://kubernetes.io/docs/concepts/storage/volumes/

容器重启它的文件会丢失、一个pod中运行多个容器可能需要共享一些文件、不同pod共享文件、日志收集

Volume可以支持`local`、`nfs`、`cephfs`、`glusterfs`以及各种云计算平台。

## hostpath

不推荐使用，将节点上的文件或目录挂载到pod上

## emptyDir

如果删除pod，emptydir卷中的数据也会被删除，一般用于pod中不同容器**共享数据**，它可以被挂载到相同或不同的路径

示例：

```yaml
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /cache
      name: cache-volume
  volumes:
  - name: cache-volume
    emptyDir: {}
```

## PC&PVC

PersistentVolume (PV)是对存储资源创建和使用的抽象，它是集群中的资源

PersistentVolumeClaim (PVC) 是对PV的申请，不需要关心具体的Volume实现细节

PV没有namespace概念，PVC有namespace隔离

<img src="https://gitee.com/c_honghui/picture/raw/master/img/20211219184540.png" alt="image-20211219184540755" style="zoom:80%;" />

### NFS类型的PV模板

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv0003
spec:
  capacity:
    storage: 5Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Recycle
  storageClassName: slow
  mountOptions:
    - hard
    - nfsvers=4.1
  nfs:
    path: /tmp
    server: 172.17.0.2
```

回收策略`persistentVolumeReclaimPolicy`：

- Recycle：删掉PVC，会rm -rf /thevolume/*将PV里的内容删除
- Retain：保留
- Delete：删除PVC后，PV也会被删掉

PV的容量`capacity`

挂载的类型`volumeMode`

访问模式`accessModes`：

- ReadWriteOnce-RWO，该卷可以被单个节点以读写方式挂载 
- ReadOnlyMany-ROX，该卷可以被许多节点以只读方式挂载
- ReadWriteMany-RWX，该卷可以被多个节点以读写方式挂载

PV类名`storageClassName`：PVC和PV的类名一样，才能被绑定