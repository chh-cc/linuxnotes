# K8S入门

## 官网

https://kubernetes.io/

每年可能会发布三次版本，可以去官网或github的changelog查看更新信息

查看1.20.0的changelog：https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.20.md#changelog-since-v1190

## 为什么用k8s

随着项目越来越多，管理的容器越来越多，裸容器部署的方式越来越难管理

**强大的故障发现和自动修复能力**

**服务滚动升级**

**扩缩容方便**

虽然K8s 1.20版本宣布将在1.23版本之后将不再维护dockershim，意味着K8s将不直接支持Docker，不过大家不必过于担心。一是在1.23版本之前我们仍然可以使用Docker，二是dockershim肯定会有人接盘，我们同样可以使用Docker，三是Docker制作的镜像仍然可以在其他Runtime环境中使用

## k8s高可用架构

![image-20210904204842750](https://gitee.com/c_honghui/picture/raw/master/img/20210904204849.png)



![img](https://gitee.com/c_honghui/picture/raw/master/img/20220217230835.png)

k8s致力于提供跨主机集群的自动部署、扩展、高可用以及运行应用程序容器的平台

**master节点**：它的主要职责是调度，即决定将应用放在哪里运行，它包括apiserver、controller、scheduler都需要和etcd进行交互以存储数据。公司生产环境一般3个master节点就足够了，一般资源一次性给够，因为改动麻烦，3个集群管理相关进程：

- Kube-APIServer：集群的控制中枢，所有的请求都需要经过这个接口进行通信，它是资源增删查改操作的唯一入口
- ControllerManager：集群的状态管理器，保证Pod或其他资源达到期望值
- Scheduler：集群的调度中心，它会根据指定的调度规则，把pod调度到一个或一批最佳的node节点

**Etcd**：键值数据库，保存一些集群的信息，一般生产环境建议部署3个以上奇数个节点，规模大的话跟master分开，要用ssd盘，一般资源一次性给够

**Node节点**：工作节点，容器运行的地方

- Kubelet：是一个代理服务，在每个节点上运行，负责监听节点上的Pod状态，同时负责上报节点和节点上面Pod的状态，负责与Master节点通信
- Kube-proxy：将到某个 Service 的访问请求转发到后端的多 个 Pod 实例上

----------

Calico：符合CNI标准的网络插件，给每个Pod生成一个唯一的IP地址，并且把每个节点当作一个路由器

CoreDNS：用于k8s集群内部Service的解析