## 架构

1. mysql的架构

   mysql主要分为server层和存储引擎层

   server层主要包括连接器、查询缓冲、分析器、优化器、执行器等

   存储引擎层主要负责数据的存储和读取

2. 主从复制原理

   将主库的更新操作通过二进制日志binlog传到从数据库，然后在从库对这些日志重新执行，从而使从库和主库的数据保持一致

3. 读写分离了解吗

   读写分离的原理是将数据库的读写请求分散到不同的节点，通过搭建主从集群，主机负责读写操作，从机只负责读操作，主机通过复制将数据同步到从机，每台数据库服务器存储了所有的业务数据。

4. 读写分离的分配怎么实现

   将读写操作区分开然后访问不同的数据库服务器，一般通过程序代码封装或中间件封装

   程序代码封装指在代码中抽象一个数据访问层 ，实现读写操作分离和数据库服务器连接的管理。

   中间件封装指的是独立一套系统出来，实现读写操作分离和数据库服务器连接的管理。

5. 你们一般是怎么分库的

   垂直分库：以表为依据，按照业务不同将不同的表拆分到不同的库中

   水平分库：以字段为依据，将一个库中的数据拆分到多个库中

## 概念

1. innodb和myisam的区别

   myisam只有表级锁，innodb支持行级锁和表级锁

   myisam不支持事务，而innodb支持事务

   mysiam不支持聚集索引，innodb支持

   | 特性   | 事务     | 并发 | 外键   | 备份   | 其他         |
   | ------ | -------- | ---- | ------ | ------ | ------------ |
   | InnoDB | 事务型   | 行锁 | 支持   | 热备   | 聚簇索引     |
   | MyISAM | 非事务型 | 表锁 | 不支持 | 不支持 | 空间数据索引 |

2. 事务？

   由一系列sql语句组成，作为单个逻辑单元执行。如果其中一个语句出错，整个事务将被回滚并撤销之前已经完成的任何修改。通过使用事务，可以确保数据在多个操作中的一致性和完整性。

## 日志

1. MySQL 的几种日志

   mysql日志主要包括慢查询日志、事务日志、错误日志、二进制日志等

   **binlog**记录了mysql数据库执行修改的所有操作，不记录select和show语句，主要用于**同步数据库**和**恢复数据库**

   **redolog**记录了innodb引擎的**事务日志**，不管事务是否提交都会记录下来，用于数据恢复，当数据库发生故障，innodb引擎会使用redolog**恢复到发生故障前的时候，保证数据的完整性**；将参数innodb_flush_log_at_tx_commit设置为1，在执行commit时会将日志同步写到磁盘

   进行数据修改时还会记录**undolog**，undolog用于数据的撤回操作，保留了修改之前的内容

2. redo log 和 binlog 有什么区别？

   redo log是物理日志，记录的是“在某个数据页上做了什么修改”；binlog是逻辑日志，记录的sql语句的原始逻辑

3. binlog有哪几种格式

   statement：每条会修改数据的**sql**都会记录到binlog，数据量小
   
   row：记录**每一行的数据变化**，数据量大
   
   mixed：一种折中方案，普通操作使用statement，当无法使用statement时使用row
   
   

## 优化

1. 如何优化查询性能

   优化mysql服务器，如缓存大小、最大连接数等

   优化sql语句，合理使用索引，避免扫描大量数据等

2. MySQL 性能指标都有哪些？如何得到这些指标？

## 备份恢复

1. 如何备份和恢复

   rds自带备份功能，备份期间不要执行DDL操作，避免锁表导致备份失败；

   基于数据备份+日志备份，可以恢复任意时间点的数据

2. 有没有办法把 MySQL 的数据恢复到过去某个指定的时间节点？怎么恢复？

## 排障

1. 慢sql

   SQL异常的原因很多，例如库表结构设计不合理、索引缺失、扫描行数太多等。

   可以在控制台的**SQL洞察**页面，查看慢SQL的执行耗时、执行次数等信息

   根据实际业务情况优化SQL

2. 

3. 主从同步延迟

   慢sql过多

   网络延迟

   主库负载过高，导致binlog写入慢

4. Cpu100%

   一般是慢sql和高qps导致

5. 隔一段时间出现IOPS100%

   查看IOPS100%的时间段QPS是否增高有没有慢日志，不行就排查IOPS100%时段的所有sql语句

6. 连接数100%

   快速解决的方法就是选择kill掉一些会话

   根本解决方法，查看是空闲连接多导致的还是活跃连接多导致的，如果是空闲连接多导致的可能需要优化一下代码；如果是活跃连接多导致的，要看下是业务高并发导致还是锁导致还是性能问题导致，再逐一对应解决